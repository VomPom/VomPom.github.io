<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="è½å¶æŒ½æ­Œ"><title>å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ FFmpeg Filter | è½å¶æŒ½æ­Œ</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + 'a642bfb7c75afbc4fe68fd942180298b';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"><script src="/js/prism.js"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ FFmpeg Filter</h1><a id="logo" href="/.">è½å¶æŒ½æ­Œ</a><p class="description">juliswang's åšå®¢</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ FFmpeg Filter</h1><div class="post-meta">2024å¹´03æœˆ07æ—¥<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.8k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 12</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><p>æ­¤å‰åœ¨åš  ffmpeg+æŸä¸ªç¬¬ä¸‰åº“ä½œä¸º filter çš„é›†æˆï¼Œç¬¬ä¸‰åº“æ˜¯åšAEç‰¹æ•ˆç›¸å…³çš„ï¼Œä¸ ffmpeg ç»“åˆèƒ½è®©è§†é¢‘æ¸²æŸ“æ•ˆæœå¤§å¤§æå‡ã€‚æ•´ä½“æµç¨‹å°†ç¬¬ä¸‰æ–¹åº“ä½œä¸º ffmpeg çš„ä¸€ä¸ªfilter å½¢å¼è¿›è¡Œç»“åˆï¼Œå…¶ä¸­å°±æ¶‰åŠåˆ° ffmpeg çš„ filter å¼€å‘ï¼Œæœ¬æ–‡å³ å¯¹ffmpeg çš„æ»¤é•œå¼€å‘æµç¨‹ä½œä¸€ä¸ªæ€»ç»“ã€‚æœ¬æ–‡ä»¥å®ç°ä¸€ä¸ªè§†é¢‘å‚ç›´ç¿»è½¬çš„ filter ä¸ºä¾‹ï¼Œffmpeg æºç åŸºäº<a href="https://github.com/FFmpeg/FFmpeg/tree/release/6.1">FFmpeg6.1</a> </p>
<h2 id="å®ç°è‡ªå®šä¹‰-Filter-æµç¨‹"><a href="#å®ç°è‡ªå®šä¹‰-Filter-æµç¨‹" class="headerlink" title="å®ç°è‡ªå®šä¹‰ Filter æµç¨‹"></a>å®ç°è‡ªå®šä¹‰ Filter æµç¨‹</h2><ul>
<li><p>ç¼–å†™ filter.c æ–‡ä»¶</p>
<p>ä¸€èˆ¬è§†é¢‘æ»¤é•œä»¥ vf_ ä¸ºå‰ç¼€ï¼Œè§†é¢‘æ»¤é•œä»¥ af_ ä¸ºå‰ç¼€ï¼Œæ”¾åœ¨libavfilterç›®å½•ä¸‹ï¼Œå‚è€ƒå…¶ä»– filter ä»£ç é€»è¾‘ï¼Œæ¨¡å—åŒ–é…ç½®ç›¸å…³å‚æ•°ï¼Œæœ¬æ–‡ä¾‹ä»¥ vf_flip.c å®ç°è§†é¢‘çš„ä¸Šä¸‹ç¿»è½¬</p>
</li>
<li><p>åœ¨ <code>libavfilter/allfilters.c</code> æ³¨å†Œ</p>
<p>ä¾‹å¦‚ï¼šextern const AVFilter ff_vf_flip;  <code>ff_vf_flip</code>å°±æ˜¯åœ¨ <code>vf_flip.c</code>çš„ filter æ³¨å†Œåç§°</p>
</li>
<li><p>ä¿®æ”¹ <code>libavfilter/Makefile</code> æ·»åŠ ç¼–è¯‘é…ç½®ï¼š </p>
<p>ä¾‹å¦‚ï¼šOBJS-$(CONFIG_FLIP_FILTER)                   +&#x3D; vf_flip.o</p>
</li>
<li><p>ç¼–è¯‘æ‰“åŒ…</p>
</li>
</ul>
<h2 id="ç¼–å†™-filter-c-æ–‡ä»¶"><a href="#ç¼–å†™-filter-c-æ–‡ä»¶" class="headerlink" title="ç¼–å†™ filter.c æ–‡ä»¶"></a>ç¼–å†™ filter.c æ–‡ä»¶</h2><h3 id="AVFilterä¸»ä½“"><a href="#AVFilterä¸»ä½“" class="headerlink" title="AVFilterä¸»ä½“"></a>AVFilterä¸»ä½“</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AVFilter</span> &#123;</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *description;</span><br><span class="line">  <span class="type">const</span> AVFilterPad *inputs;</span><br><span class="line">  <span class="type">const</span> AVFilterPad *outputs;</span><br><span class="line">  <span class="type">const</span> AVClass *priv_class;</span><br><span class="line">  <span class="type">int</span> flags;</span><br><span class="line">  <span class="type">int</span> (*preinit)(AVFilterContext *ctx);</span><br><span class="line">  <span class="type">int</span> (*init)(AVFilterContext *ctx);</span><br><span class="line">  <span class="type">int</span> (*init_dict)(AVFilterContext *ctx, AVDictionary **options);</span><br><span class="line">  <span class="type">void</span> (*uninit)(AVFilterContext *ctx);</span><br><span class="line">  <span class="type">int</span> (*query_formats)(AVFilterContext *);</span><br><span class="line">  <span class="type">int</span> priv_size;   </span><br><span class="line">  <span class="type">int</span> flags_internal; </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">AVFilter</span> *<span class="title">next</span>;</span></span><br><span class="line">  <span class="type">int</span> (*process_command)(AVFilterContext *, <span class="type">const</span> <span class="type">char</span> *cmd, <span class="type">const</span> <span class="type">char</span> *arg, <span class="type">char</span> *res, <span class="type">int</span> res_len, <span class="type">int</span> flags);</span><br><span class="line">  <span class="type">int</span> (*init_opaque)(AVFilterContext *ctx, <span class="type">void</span> *opaque);</span><br><span class="line">  <span class="type">int</span> (*activate)(AVFilterContext *ctx);</span><br><span class="line">&#125; AVFilter;</span><br></pre></td></tr></table></figure>

<p>å…·ä½“é‡Œé¢çš„å±æ€§ä½œç”¨å¯ä»¥å‚è€ƒï¼š<a href="https://www.cnblogs.com/TaigaCon/p/10171464.html">[ffmpeg] å®šåˆ¶æ»¤æ³¢å™¨</a>ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚å®ç°é‡Œé¢çš„ç›¸å…³å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä»¥ä¸€ä¸ªæœ€ç®€å•çš„ Filter å’Œä¸€ä¸ªè¾ƒå¤æ‚ä¸€ç‚¹çš„ Filter ä¸¾ä¾‹ã€‚</p>
<h3 id="æœ€ç®€å•çš„-AVFilter"><a href="#æœ€ç®€å•çš„-AVFilter" class="headerlink" title="æœ€ç®€å•çš„ AVFilter"></a>æœ€ç®€å•çš„ AVFilter</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> AVClass *<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line">&#125; NoopContext;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">filter_frame</span><span class="params">(AVFilterLink *link, AVFrame *frame)</span> &#123;</span><br><span class="line">    av_log(<span class="literal">NULL</span>, AV_LOG_INFO, <span class="string">&quot;filter frame pts:%lld\n&quot;</span>, frame-&gt;pts);</span><br><span class="line">    NoopContext *noopContext = link-&gt;dst-&gt;priv;</span><br><span class="line">    <span class="keyword">return</span> ff_filter_frame(link-&gt;dst-&gt;outputs[<span class="number">0</span>], frame);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> AVFilterPad noop_inputs[] = &#123;</span><br><span class="line">        &#123;</span><br><span class="line">                .name         = <span class="string">&quot;default&quot;</span>,</span><br><span class="line">                .type         = AVMEDIA_TYPE_VIDEO,</span><br><span class="line">                .filter_frame = filter_frame,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> AVFilterPad noop_outputs[] = &#123;</span><br><span class="line">        &#123;</span><br><span class="line">                .name = <span class="string">&quot;default&quot;</span>,</span><br><span class="line">                .type = AVMEDIA_TYPE_VIDEO,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> AVFilter ff_vf_noop = &#123;</span><br><span class="line">        .name          = <span class="string">&quot;noop&quot;</span>,</span><br><span class="line">        .description   = NULL_IF_CONFIG_SMALL(<span class="string">&quot;Pass the input video unchanged.&quot;</span>),</span><br><span class="line">        .priv_size     = <span class="keyword">sizeof</span>(NoopContext),</span><br><span class="line">        FILTER_INPUTS(noop_inputs),</span><br><span class="line">        FILTER_OUTPUTS(noop_outputs),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤è¡Œè¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ffmpeg -i test.mp4 -vf &quot;noop&quot; noop.mp4</span><br></pre></td></tr></table></figure>

<p> æ­£å¸¸è¾“å‡ºæ–‡ä»¶ï¼ˆå¯¹åŸç‰‡æ²¡æœ‰åšä»»ä½•æ›´æ”¹ï¼‰,è¿™ä¸ª filter çš„ä½œç”¨æ˜¯å°†è¾“å…¥çš„è§†é¢‘å¸§ä¸åšä»»ä½•å¤„ç†åœ°ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨å¤„ç†æ¯å¸§çš„æ—¶å€™ä¼šæ‰“å°å¤„ç†çš„ PTSï¼Œéº»é›€è™½å°äº”è„ä¿±å…¨ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ª AVFilter åŸºç¡€çš„ç»“æ„ï¼š</p>
<ol>
<li><p><strong><code>NoopContext</code></strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘ AVClass çš„æŒ‡é’ˆã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨åˆ° NoopContext ç»“æ„ä½“çš„ä»»ä½•æˆå‘˜ï¼Œå› ä¸ºè¿™ä¸ªè¿‡æ»¤å™¨æ²¡æœ‰éœ€è¦å­˜å‚¨çš„ç§æœ‰æ•°æ®ã€‚</p>
</li>
<li><p><strong><code>filter_frame</code></strong> </p>
<p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å¤„ç†è¾“å…¥çš„è§†é¢‘å¸§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒåªæ˜¯æ‰“å°å¸§çš„ PTSï¼ˆPresentation Time Stampï¼Œæ˜¾ç¤ºæ—¶é—´æˆ³ï¼‰å¹¶å°†å¸§ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¸å¯¹å¸§åšä»»ä½•ä¿®æ”¹ã€‚</p>
</li>
<li><p><strong><code>noop_inputs</code> å’Œ <code>noop_outputs</code></strong></p>
<p>è¿™ä¸¤ä¸ªæ•°ç»„å®šä¹‰äº†è¿‡æ»¤å™¨çš„è¾“å…¥å’Œè¾“å‡º Padã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¾“å…¥ Pad ç±»å‹ä¸º AVMEDIA_TYPE_VIDEOï¼Œå¹¶å…³è”äº† <code>filter_frame</code> å‡½æ•°ã€‚è¾“å‡º Pad ä¹Ÿæ˜¯ AVMEDIA_TYPE_VIDEO ç±»å‹ï¼Œä½†æ²¡æœ‰å…³è”ä»»ä½•å‡½æ•°ï¼Œå› ä¸ºè¾“å‡ºç›´æ¥ç”± <code>filter_frame</code> å‡½æ•°å¤„ç†ã€‚</p>
</li>
<li><p><strong><code>ff_vf_noop</code></strong></p>
<p>è¿™æ˜¯ä¸€ä¸ª AVFilter ç»“æ„ä½“å®ä¾‹ï¼ŒåŒ…å«äº†è¿‡æ»¤å™¨çš„åç§°ã€æè¿°ã€ç§æœ‰æ•°æ®å¤§å°ä»¥åŠè¾“å…¥å’Œè¾“å‡º Padã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿‡æ»¤å™¨çš„åç§°ä¸º â€œnoopâ€ï¼Œæè¿°ä¸º â€œPass the input video unchanged.â€ï¼Œè¿™ä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œï¼š<code>ffmpeg -filters</code> çœ‹åˆ°çš„ Filteræè¿°å†…å®¹ã€‚</p>
</li>
</ol>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¸€ä¸ª AVFilterï¼Œå®ç°ä¸€ä¸ªè§†é¢‘çš„ä¸Šä¸‹ç¿»è½¬</p>
<h3 id="å¤æ‚ä¸€ç‚¹çš„-AVFilter"><a href="#å¤æ‚ä¸€ç‚¹çš„-AVFilter" class="headerlink" title="å¤æ‚ä¸€ç‚¹çš„ AVFilter"></a>å¤æ‚ä¸€ç‚¹çš„ AVFilter</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">FlipContext</span> &#123;</span></span><br><span class="line">    <span class="type">const</span> AVClass *<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line">    <span class="type">int</span> duration;</span><br><span class="line">&#125; FlipContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET(x) offsetof(FlipContext, x)</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> AVOption flip_options[] = &#123;</span><br><span class="line">        &#123;<span class="string">&quot;duration&quot;</span>, <span class="string">&quot;set flip duration&quot;</span>, OFFSET(duration), AV_OPT_TYPE_INT, &#123;.i64 = <span class="number">0</span>&#125;, <span class="number">0</span>, INT_MAX, .flags = AV_OPT_FLAG_FILTERING_PARAM&#125;,</span><br><span class="line">        &#123;<span class="literal">NULL</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> av_cold <span class="type">int</span> <span class="title function_">flip_init</span><span class="params">(AVFilterContext *ctx)</span> &#123;</span><br><span class="line">    FlipContext *context = ctx-&gt;priv;</span><br><span class="line">    av_log(<span class="literal">NULL</span>, AV_LOG_ERROR, <span class="string">&quot;Input duration: %d.\n&quot;</span>, context-&gt;duration);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> av_cold <span class="type">void</span> <span class="title function_">flip_uninit</span><span class="params">(AVFilterContext *ctx)</span> &#123;</span><br><span class="line">    FlipContext *context = ctx-&gt;priv;</span><br><span class="line">    <span class="comment">// no-op æœ¬ä¾‹æ— éœ€é‡Šæ”¾æ»¤é•œå®ä¾‹åˆ†é…çš„å†…å­˜ã€å…³é—­æ–‡ä»¶ã€èµ„æºç­‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è¾“å…¥çš„ AVFrame è¿›è¡Œç¿»è½¬</span></span><br><span class="line"><span class="type">static</span> AVFrame *<span class="title function_">flip_frame</span><span class="params">(AVFilterContext *ctx, AVFrame *in_frame)</span> &#123;</span><br><span class="line"> 		AVFilterLink *inlink = ctx-&gt;inputs[<span class="number">0</span>];</span><br><span class="line">    FlipContext *s = ctx-&gt;priv;</span><br><span class="line">    <span class="type">int64_t</span> pts = in_frame-&gt;pts;</span><br><span class="line">    <span class="comment">// å°†æ—¶é—´æˆ³ï¼ˆptsï¼‰è½¬åŒ–ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="type">float</span> time_s = TS2T(pts, inlink-&gt;time_base);</span><br><span class="line">    <span class="keyword">if</span> (time_s &gt; s-&gt;duration) &#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡å¯¹åº”çš„æ—¶é—´åˆ™ç›´æ¥è¾“å‡ºin_frame</span></span><br><span class="line">        <span class="keyword">return</span> in_frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè¾“å‡ºå¸§å¹¶åˆ†é…å†…å­˜</span></span><br><span class="line">    AVFrame *out_frame = av_frame_alloc();</span><br><span class="line">    <span class="keyword">if</span> (!out_frame) &#123;</span><br><span class="line">        av_frame_free(&amp;in_frame);</span><br><span class="line">        <span class="keyword">return</span> out_frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®è¾“å‡ºå¸§çš„å±æ€§</span></span><br><span class="line">    out_frame-&gt;format = in_frame-&gt;format;</span><br><span class="line">    out_frame-&gt;width = in_frame-&gt;width;</span><br><span class="line">    out_frame-&gt;height = in_frame-&gt;height;</span><br><span class="line">    out_frame-&gt;pts = in_frame-&gt;pts;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†é…è¾“å‡ºå¸§çš„æ•°æ®ç¼“å†²åŒº</span></span><br><span class="line">    <span class="type">int</span> ret = av_frame_get_buffer(out_frame, <span class="number">32</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        av_frame_free(&amp;in_frame);</span><br><span class="line">        av_frame_free(&amp;out_frame);</span><br><span class="line">        <span class="keyword">return</span> out_frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªç¤ºä¾‹ä»…é€‚ç”¨äº YUV æ ¼å¼çš„è§†é¢‘ã€‚å¯¹äºå…¶ä»–æ ¼å¼ï¼ˆå¦‚ RGBï¼‰</span></span><br><span class="line">    <span class="comment">// ç¿»è½¬è¾“å…¥å¸§çš„æ•°æ®åˆ°è¾“å‡ºå¸§</span></span><br><span class="line">    <span class="comment">// ç¿»è½¬äº† Y åˆ†é‡ï¼Œç„¶åç¿»è½¬äº† U å’Œ V åˆ†é‡</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="type">uint8_t</span> *src_y = in_frame-&gt;data[<span class="number">0</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *src_u = in_frame-&gt;data[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *src_v = in_frame-&gt;data[<span class="number">2</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *dst_y = out_frame-&gt;data[<span class="number">0</span>] + (in_frame-&gt;height - <span class="number">1</span>) * out_frame-&gt;linesize[<span class="number">0</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *dst_u = out_frame-&gt;data[<span class="number">1</span>] + (in_frame-&gt;height / <span class="number">2</span> - <span class="number">1</span>) * out_frame-&gt;linesize[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *dst_v = out_frame-&gt;data[<span class="number">2</span>] + (in_frame-&gt;height / <span class="number">2</span> - <span class="number">1</span>) * out_frame-&gt;linesize[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; in_frame-&gt;height; i++) &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(dst_y, src_y, in_frame-&gt;width);</span><br><span class="line">        src_y += in_frame-&gt;linesize[<span class="number">0</span>];</span><br><span class="line">        dst_y -= out_frame-&gt;linesize[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i &lt; in_frame-&gt;height / <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(dst_u, src_u, in_frame-&gt;width / <span class="number">2</span>);</span><br><span class="line">            <span class="built_in">memcpy</span>(dst_v, src_v, in_frame-&gt;width / <span class="number">2</span>);</span><br><span class="line">            src_u += in_frame-&gt;linesize[<span class="number">1</span>];</span><br><span class="line">            src_v += in_frame-&gt;linesize[<span class="number">2</span>];</span><br><span class="line">            dst_u -= out_frame-&gt;linesize[<span class="number">1</span>];</span><br><span class="line">            dst_v -= out_frame-&gt;linesize[<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> out_frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">activate</span><span class="params">(AVFilterContext *ctx)</span> &#123;</span><br><span class="line">    AVFilterLink *inlink = ctx-&gt;inputs[<span class="number">0</span>];</span><br><span class="line">    AVFilterLink *outlink = ctx-&gt;outputs[<span class="number">0</span>];</span><br><span class="line">    AVFrame *in_frame = <span class="literal">NULL</span>;</span><br><span class="line">    AVFrame *out_frame = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è·å–è¾“å…¥å¸§</span></span><br><span class="line">    ret = ff_inlink_consume_frame(inlink, &amp;in_frame);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰è¾“å…¥å¸§ï¼Œè¿›è¡Œç¿»è½¬å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (in_frame) &#123;</span><br><span class="line">        <span class="comment">// å¯¹è¾“å‡ºå¸§è¿›è¡Œä¸Šä¸‹ç¿»è½¬å¤„ç†</span></span><br><span class="line">        out_frame = flip_frame(ctx, in_frame);</span><br><span class="line">        <span class="comment">// å°†å¤„ç†åçš„å¸§æ”¾å…¥è¾“å‡ºç¼“å†²åŒº</span></span><br><span class="line">        ret = ff_filter_frame(outlink, out_frame);</span><br><span class="line">        <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            av_frame_free(&amp;out_frame);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è¾“å…¥å¸§ï¼Œå°è¯•è¯·æ±‚ä¸€ä¸ªæ–°çš„è¾“å…¥å¸§</span></span><br><span class="line">    <span class="keyword">if</span> (!in_frame) &#123;</span><br><span class="line">        ff_inlink_request_frame(inlink);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="type">int64_t</span> pts;</span><br><span class="line">    ret = ff_inlink_acknowledge_status(inlink, &amp;status, &amp;pts);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    <span class="keyword">if</span> (status == AVERROR_EOF) &#123;</span><br><span class="line">        <span class="comment">// è¾“å…¥é“¾æ¥å·²ç»ç»“æŸï¼Œè®¾ç½®è¾“å‡ºé“¾æ¥çš„çŠ¶æ€ä¸º EOF</span></span><br><span class="line">        ff_outlink_set_status(outlink, AVERROR_EOF, pts);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AVFILTER_DEFINE_CLASS(flip);</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> AVFilterPad flip_inputs[] = &#123;</span><br><span class="line">        &#123;</span><br><span class="line">                .name = <span class="string">&quot;default&quot;</span>,</span><br><span class="line">                .type = AVMEDIA_TYPE_VIDEO,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> AVFilterPad flip_outputs[] = &#123;</span><br><span class="line">        &#123;</span><br><span class="line">                .name = <span class="string">&quot;default&quot;</span>,</span><br><span class="line">                .type = AVMEDIA_TYPE_VIDEO,</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> AVFilter ff_vf_flip = &#123;</span><br><span class="line">        .name = <span class="string">&quot;flip&quot;</span>,</span><br><span class="line">        .description = NULL_IF_CONFIG_SMALL(<span class="string">&quot;Flip the input video.&quot;</span>),</span><br><span class="line">        .priv_size = <span class="keyword">sizeof</span>(FlipContext),</span><br><span class="line">        .priv_class = &amp;flip_class,</span><br><span class="line">        .activate      = activate,</span><br><span class="line">        .init = flip_init,</span><br><span class="line">        .uninit = flip_uninit,</span><br><span class="line">        FILTER_INPUTS(flip_inputs),</span><br><span class="line">        FILTER_OUTPUTS(flip_outputs),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤è¡Œè¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffmpeg -i test.mp4 -filter_complex &quot;[0:v]flip=duration=5[out];&quot; -map &quot;[out]&quot; flip.mp4</span><br></pre></td></tr></table></figure>

<p> å¾—åˆ°æ¸²æŸ“å¥½çš„è§†é¢‘ï¼Œå‰5sæ˜¯ä¸Šä¸‹ç¿»è½¬çš„ï¼Œåé¢çš„å†…å®¹æ­£å¸¸ã€‚</p>
<p>ç›¸æ¯”äºæœ€ç®€å•çš„ AVFilter å¤šäº†å‡ ä¸ªå®ç°ï¼š</p>
<ol>
<li><p><strong><code>AVOption flip_options</code></strong></p>
<p>ç”¨äºè®¾ç½®ç¿»è½¬æŒç»­æ—¶é—´çš„é€‰é¡¹ï¼Œå¤–éƒ¨å‘½ä»¤é…ç½®å¯é€‰è¾“å…¥<code>duration=5</code>ï¼Œä¼šè‡ªåŠ¨å¯¹æ•°æ®åˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚å‚æ•°ç±»å‹ä¸º <code>AV_OPT_TYPE_INT</code>ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå–å€¼èŒƒå›´ä¸º 0 åˆ° <code>INT_MAX</code>ã€‚<code>.flags</code> è®¾ç½®ä¸º <code>AV_OPT_FLAG_FILTERING_PARAM</code>ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å‚æ•°ã€‚</p>
</li>
<li><p><strong><code>.priv_class</code></strong>  </p>
<p>é…ç½®çš„<code>flip_class</code>å®é™…æ˜¯é€šè¿‡ <code>AVFILTER_DEFINE_CLASS(flip);</code> å®å®ç°çš„ä¸€ä¸ªå£°æ˜ï¼šè§ï¼š<a href="https://github.com/FFmpeg/FFmpeg/blob/release/6.1/libavfilter/internal.h#L311">internal.h#AVFILTER_DEFINE_CLASS_EXT</a></p>
</li>
<li><p><strong><code>**init</code>&amp; <code>uninit</code></strong></p>
<p>æ»¤é•œåœ¨åˆå§‹åŒ–æˆ–è€…é‡Šæ”¾èµ„æºçš„æ—¶å€™å°†ä¼šè°ƒç”¨</p>
</li>
<li><p><strong><code>activate</code></strong></p>
<p>è¿™ä¸ªå‡½æ•°é¦–å…ˆè·å–è¾“å…¥å¸§ï¼Œç„¶åè°ƒç”¨ <code>flip_frame</code> å‡½æ•°è¿›è¡Œç¿»è½¬æ“ä½œï¼Œå¹¶å°†å¤„ç†åçš„å¸§æ”¾å…¥è¾“å‡ºé“¾æ¥ã€‚å¦‚æœæ²¡æœ‰è¾“å…¥å¸§ï¼Œå®ƒä¼šè¯·æ±‚ä¸€ä¸ªæ–°çš„è¾“å…¥å¸§ã€‚æœ€åï¼Œå®ƒä¼šç¡®è®¤è¾“å…¥é“¾æ¥çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®éœ€è¦è®¾ç½®è¾“å‡ºé“¾æ¥çš„çŠ¶æ€ã€‚</p>
</li>
</ol>
<p>è¿™ä¸ªä¾‹å­ç›¸æ¯”æœ€ç®€å•çš„ filter ä½¿ç”¨äº† <code>activate</code> å‡½æ•° ç”¨äºå¸§æ¸²æŸ“ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>filter_frame</code>å»æ¸²æŸ“ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«äºè”ç³»å‘¢ï¼ŸæŸ¥çœ‹ï¼š<a href="##filter_frame()%E5%92%8Cactivate()%E5%87%BD%E6%95%B0">filter_frameå’Œactivateæ–¹æ³•</a></p>
<p>ä¹Ÿèƒ½é€šè¿‡ <code>filter_frame</code>å®ç°ï¼Œå¯¹ä»£ç éƒ¨åˆ†é€»è¾‘æ›´æ–°æ›´æ”¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> AVFilterPad flip_inputs[] = &#123;</span><br><span class="line">        &#123;</span><br><span class="line">                .name = <span class="string">&quot;default&quot;</span>,</span><br><span class="line">                .type = AVMEDIA_TYPE_VIDEO,</span><br><span class="line">                .filter_frame = filter_frame, <span class="comment">//æ·»åŠ filter_frame å®ç°</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> AVFilter ff_vf_flip = &#123;</span><br><span class="line">       â€¦â€¦</span><br><span class="line">        .priv_class = &amp;flip_class,</span><br><span class="line">       <span class="comment">// .activate      = activate,</span></span><br><span class="line">        .init = flip_init,</span><br><span class="line">       â€¦â€¦</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">filter_frame</span><span class="params">(AVFilterLink *inlink, AVFrame *in)</span> &#123;</span><br><span class="line">    AVFilterContext *ctx = inlink-&gt;dst;</span><br><span class="line">    FlipContext *s = ctx-&gt;priv;</span><br><span class="line">    AVFilterLink *outlink = ctx-&gt;outputs[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int64_t</span> pts = in-&gt;pts;</span><br><span class="line">    <span class="comment">// å°†æ—¶é—´æˆ³ï¼ˆptsï¼‰è½¬åŒ–ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="type">float</span> time_s = TS2T(pts, inlink-&gt;time_base);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (time_s &gt; s-&gt;duration) &#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡å¯¹åº”çš„æ—¶é—´åˆ™ç›´æ¥è¾“å‡ºin_frame</span></span><br><span class="line">        <span class="keyword">return</span> ff_filter_frame(outlink, in);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        av_log(<span class="literal">NULL</span>, AV_LOG_ERROR, <span class="string">&quot;time_s s: %f.\n&quot;</span>, time_s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AVFrame *out = flip_frame(ctx, in);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾è¾“å…¥å¸§</span></span><br><span class="line">    av_frame_free(&amp;in);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¾“å‡ºå¸§ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ»¤é•œ</span></span><br><span class="line">    <span class="keyword">return</span> ff_filter_frame(outlink, out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤è¡Œè¿è¡Œï¼Œå¾—åˆ°çš„è¾“å‡ºç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="filter-frame-å’Œactivate-å‡½æ•°"><a href="#filter-frame-å’Œactivate-å‡½æ•°" class="headerlink" title="filter_frame()å’Œactivate()å‡½æ•°"></a>filter_frame()å’Œactivate()å‡½æ•°</h2><p>å¯¹äºè¿™ç‚¹æŸ¥äº†ç›¸å…³èµ„æ–™ï¼Œçœ‹çœ‹æºç ç›¸å…³çš„å®ç°</p>
<p>å‚è€ƒï¼š<a href="https://www.ffmpeg.org/doxygen/5.0/filter__design_8txt.html">https://www.ffmpeg.org/doxygen/5.0/filter__design_8txt.html</a></p>
<blockquote>
<p>The purpose of these rules is to ensure that frames flow in the filter graph without getting stuck and accumulating somewhere. Simple filters that output one frame for each input frame should not have to worry about it. There are two design for filters:one using the  <a href="https://www.ffmpeg.org/doxygen/5.0/vsink__nullsink_8c.html#aaa9a0e0f9de1464941d86a984cf77d37">filter_frame</a>() and <a href="https://www.ffmpeg.org/doxygen/5.0/vsrc__mptestsrc_8c.html#a72949c8fcad3f201712a3569fc6888cb">request_frame</a>() callbacks and the other using the activate() callback. The design using filter_frame() and request_frame() is legacy, but it is suitable for filters that have a single input and process one frame at a time. New filters with several inputs, that treat several frames at a time or that require a special treatment at EOF should probably use the design using activate(). activate â€”â€”â€“ This method is called when something must be done in a filter</p>
</blockquote>
<p>å¤§æ„ï¼Œå®ç°æ»¤é•œæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<ul>
<li><p><strong><code>filter_frame()</code></strong></p>
<p>å¯ä»¥è¢«è®¤ä¸ºæ˜¯å†å²é—ç•™äº§ç‰©ã€‚åœ¨æ—©æœŸçš„ AVFilter è®¾è®¡ä¸­ï¼Œ<code>filter_frame()</code> å’Œ <code>request_frame()</code> æ˜¯ä¸»è¦ç”¨äºå¤„ç†è¾“å…¥å¸§å’Œè¯·æ±‚è¾“å‡ºå¸§çš„å›è°ƒå‡½æ•°ã€‚è¿™ç§è®¾è®¡é€‚ç”¨äºç®€å•çš„è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚å•è¾“å…¥ä¸”æ¯æ¬¡å¤„ç†ä¸€ä¸ªå¸§çš„è¿‡æ»¤å™¨ã€‚</p>
</li>
<li><p><strong><code>activate()</code></strong></p>
<p>éšç€ ffmpeg å’Œ AVFilter çš„å‘å±•ï¼Œå¤„ç†éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä¾‹å¦‚éœ€è¦å¤„ç†å¤šä¸ªè¾“å…¥ã€ä¸€æ¬¡å¤„ç†å¤šä¸ªå¸§æˆ–åœ¨æ–‡ä»¶ç»“æŸï¼ˆEOFï¼‰æ—¶è¿›è¡Œç‰¹æ®Šå¤„ç†ç­‰ã€‚ä¸ºäº†æ»¡è¶³è¿™äº›éœ€æ±‚ï¼Œå¼•å…¥äº† <code>activate()</code> å‡½æ•°ï¼Œå®ƒæä¾›äº†æ›´çµæ´»å’Œå¼ºå¤§çš„å¤„ç†èƒ½åŠ›ã€‚å› æ­¤ï¼Œè™½ç„¶ <code>filter_frame()</code> åœ¨æŸäº›ç®€å•åœºæ™¯ä¸‹ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†å¯¹äºæ–°çš„æˆ–å¤æ‚çš„è¿‡æ»¤å™¨ï¼Œå»ºè®®ä½¿ç”¨ <code>activate()</code> å‡½æ•°ã€‚</p>
</li>
</ul>
<p>å¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½å®ç°äº†ï¼Œé‚£ä»–ä»¬è°ä¼šå…ˆæ‰§è¡Œå‘¢ï¼Ÿ</p>
<p>å¯¹åº”çš„æºç å¤„ç†é€»è¾‘ï¼š <a href="https://github.com/FFmpeg/FFmpeg/blob/release/6.1/libavfilter/avfilter.c#L1322">avfilter.c</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">ff_filter_activate</span><span class="params">(AVFilterContext *filter)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">		â€¦â€¦</span><br><span class="line">    ret = filter-&gt;filter-&gt;activate ? filter-&gt;filter-&gt;activate(filter) :</span><br><span class="line">          ff_filter_activate_default(filter);</span><br><span class="line">  	â€¦â€¦</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé…ç½®äº†activate() å‡½æ•°åˆ™æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡Œ ff_filter_activate_default()-&gt;ff_filter_frame_to_filter()-&gt;ff_filter_frame_framed() æœ€ç»ˆæ‰§è¡Œåˆ°é…ç½®çš„ filter_frame() æ–¹æ³•ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ff_filter_frame_framed</span><span class="params">(AVFilterLink *link, AVFrame *frame)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> (*filter_frame)(AVFilterLink *, AVFrame *);</span><br><span class="line">    AVFilterContext *dstctx = link-&gt;dst;</span><br><span class="line">    AVFilterPad *dst = link-&gt;dstpad;</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(filter_frame = dst-&gt;filter_frame))</span><br><span class="line">        filter_frame = default_filter_frame;</span><br><span class="line">    â€¦â€¦</span><br><span class="line">    ret = filter_frame(link, frame);  <span class="comment">// æœ€ç»ˆè°ƒç”¨åˆ°çš„åœ°æ–¹</span></span><br><span class="line">    link-&gt;frame_count_out++;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">fail:</span><br><span class="line">    â€¦â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº† FFmpeg æ»¤é•œå¼€å‘çš„æ•´ä½“æµç¨‹ï¼Œå¦‚ä½•ç¼–å†™ filter.c æ–‡ä»¶ï¼Œå¹¶ä»¥ä¸€ä¸ªæœ€ç®€å•çš„ AVFilter å’Œä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ AVFilter ä¸ºä¾‹ï¼Œè§£æäº†æ»¤é•œå¼€å‘çš„å…·ä½“æ­¥éª¤å’Œä»£ç å®ç°ï¼Œå¹¶ä»‹ç»äº† filter_frame() å’Œ activate() å‡½æ•°çš„åŒºåˆ«ä¸è”ç³»ã€‚</p>
<p>åœ¨æ»¤é•œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œfilter_frame() å’Œ activate() å‡½æ•°çš„ä½¿ç”¨å–å†³äºæ»¤é•œçš„å¤æ‚æ€§ã€‚å¯¹äºç®€å•çš„æ»¤é•œï¼Œå¯ä»¥ä½¿ç”¨ filter_frame() å‡½æ•°ï¼›è€Œå¯¹äºéœ€è¦å¤„ç†å¤šä¸ªè¾“å…¥ã€ä¸€æ¬¡å¤„ç†å¤šä¸ªå¸§æˆ–åœ¨æ–‡ä»¶ç»“æŸï¼ˆEOFï¼‰æ—¶è¿›è¡Œç‰¹æ®Šå¤„ç†çš„å¤æ‚æ»¤é•œï¼Œå»ºè®®ä½¿ç”¨ activate() å‡½æ•°ã€‚</p>
<p>æ–‡ä¸­çš„æºç å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://github.com/VomPom/FFmpeg/commit/9176f58ae60e0b70e5708b25017f374deac9fae7">add most simplest  AVFilter and a simple video flip filter.</a></p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><p><a href="https://www.cnblogs.com/TaigaCon/p/10171464.html">https://www.cnblogs.com/TaigaCon/p/10171464.html</a></p>
<p><a href="https://www.cnblogs.com/ranson7zop/p/7728639.html">https://www.cnblogs.com/ranson7zop/p/7728639.html</a></p>
<p><a href="https://www.ffmpeg.org/doxygen/5.0/filter__design_8txt.html">https://www.ffmpeg.org/doxygen/5.0/filter__design_8txt.html</a></p>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css?v=1.0.0"><script type="text/javascript" src="/js/donate.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><a class="pos-f tr3" id="github" href="https://github.com/Kaiyuan/donate-page" target="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="AliPay" qr="https://cdn.julis.wang/blog/img/ali_pay.jpeg"></li><li id="WeChat" qr="https://cdn.julis.wang/blog/img/wechat_pay.png"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FFmpeg/" rel="tag">FFmpeg</a></li></ul></div><div class="post-nav"><a class="pre" href="/2024/04/11/%E5%85%B3%E4%BA%8EWindows%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%E4%B9%B1%E7%A0%81/">UTF-8å­—ç¬¦ç¼–ç ç›¸å…³</a><a class="next" href="/2023/10/31/%E8%87%AA%E5%AE%9A%E4%B9%89LayoutManager%E4%BB%8E0%E5%88%B01%E5%AE%9E%E8%B7%B5/">RecyclerViewè‡ªå®šä¹‰LayoutManagerä»0åˆ°1å®è·µ</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.png"/></a><p>For a better life.</p><a class="info-icon" href="mailto:admin@domain.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/vompom" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">æ€è€ƒæ€»ç»“</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">æŠ€æœ¯æ–‡ç« </a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">ç”Ÿæ´»æ„Ÿæƒ³</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95%E7%A0%94%E7%A9%B6/">ç®—æ³•ç ”ç©¶</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/movie/">è¯»ä¹¦ç”µå½±</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/travel/" style="font-size: 15px;">æ—…è¡Œ</a> <a href="/tags/zhihu/" style="font-size: 15px;">çŸ¥ä¹</a> <a href="/tags/plugins/" style="font-size: 15px;">æ’ä»¶åŒ–</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 15px;">é€†å‘</a> <a href="/tags/FFmpeg/" style="font-size: 15px;">FFmpeg</a> <a href="/tags/MediaCodec/" style="font-size: 15px;">MediaCodec</a> <a href="/tags/Android/" style="font-size: 15px;">å®‰å“</a> <a href="/tags/KMP/" style="font-size: 15px;">KMP</a> <a href="/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tags/Https/" style="font-size: 15px;">Https</a> <a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/JNI/" style="font-size: 15px;">JNI</a> <a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/mmap/" style="font-size: 15px;">mmap</a> <a href="/tags/koin/" style="font-size: 15px;">koin</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">ç½‘ç»œ</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/life/" style="font-size: 15px;">ç”Ÿæ´»</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 15px;">è¯»ä¹¦</a> <a href="/tags/thinking/" style="font-size: 15px;">çœ</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 15px;">æ•°å­¦</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">æ’ä»¶</a> <a href="/tags/UTF-8/" style="font-size: 15px;">UTF-8</a> <a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 15px;">å¤§å­¦</a> <a href="/tags/algorithm/" style="font-size: 15px;">ç®—æ³•</a> <a href="/tags/design/" style="font-size: 15px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 15px;">è§†é¢‘</a> <a href="/tags/flutter/" style="font-size: 15px;">flutter</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">å·¥å…·</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/technology/" style="font-size: 15px;">æŠ€æœ¯æ–‡ç« </a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">å‰ç«¯</a> <a href="/tags/%E8%AF%97%E6%AD%8C/" style="font-size: 15px;">è¯—æ­Œ</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">é¢è¯•</a> <a href="/tags/middle/" style="font-size: 15px;">é«˜ä¸­</a> <a href="/tags/%E9%B8%BF%E8%92%99/" style="font-size: 15px;">é¸¿è’™</a> <a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/08/25/Koin-%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A3%E7%9B%B8%E5%85%B3/">æ‰‹å†™ä¸€ä¸ªç²¾ç®€ç‰ˆKoinï¼šæ·±å…¥ç†è§£ä¾èµ–æ³¨å…¥æ ¸å¿ƒåŸç†</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/07/28/Compose-Multiplatform-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%8D%9A%E5%AE%A2%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/">[Compose Multiplatform]è·¨å¹³å°åšå®¢åº”ç”¨å®è·µ</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/05/16/%E9%B8%BF%E8%92%99-%E5%86%99%E4%BA%86%E4%B8%AA%E5%9F%BA%E4%BA%8EHexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E9%B8%BF%E8%92%99App/">[é¸¿è’™]å†™äº†ä¸ªåŸºäºHexoåšå®¢çš„é¸¿è’™App</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/30/KV-%E5%AD%98%E5%82%A8%E4%B9%8Bmmkv/">KV-å­˜å‚¨ä¹‹mmkv</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/17/Learn-from-RetroFit/">RetroFit2 æºç å­¦ä¹ ç›¸å…³</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/24/Android%E5%B1%8F%E5%B9%95%E5%88%B7%E6%96%B0%E6%9C%BA%E5%88%B6/">Androidå±å¹•åˆ·æ–°æœºåˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/11/10/%E5%85%B3%E4%BA%8E-pthread-key-t-%E5%AF%BC%E8%87%B4%E7%9A%84-Android-Crash-%E7%9A%84%E6%8E%A2%E7%B4%A2/">å…³äº pthread_key_t å¯¼è‡´çš„ Android Crash çš„æ¢ç´¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/09/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84%E5%B8%B8%E9%9D%92%E6%8A%80%E8%83%BD/">[è¯‘]è½¯ä»¶å¼€å‘äººå‘˜çš„å¸¸é’æŠ€èƒ½</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/04/11/%E5%85%B3%E4%BA%8EWindows%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%E4%B9%B1%E7%A0%81/">UTF-8å­—ç¬¦ç¼–ç ç›¸å…³</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/03/07/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89FFmpeg-Filter/">å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ FFmpeg Filter</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://github.com/VomPom" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.douban.com/people/vompom/" title="è±†ç“£" target="_blank">è±†ç“£</a><ul></ul><a href="mailto:1607637473@qq.com" title="é‚®ç®±" target="_blank">é‚®ç®±</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2025 <a href="/." rel="nofollow">è½å¶æŒ½æ­Œ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.<p></a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>