{"data":{"title":"JPEG压缩之DCT离散余弦变换","slug":"JPEG压缩之DCT离散余弦变换","description":"","date":"2025-11-04T14:25:17.000Z","updated":"2025-11-08T03:17:35.317Z","language":"zh-CN","comments":true,"url":"2025/11/04/JPEG压缩之DCT离散余弦变换/","cover":null,"images":[],"content":"<p>在<a href=\"https://github.com/leandromoreira/digital_video_introduction.git\">digital_video_introduction</a>的一节中讲解 <a href=\"https://github.com/leandromoreira/digital_video_introduction/blob/master/README-cn.md#%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84\">视频编解码器是如何工作的？</a>提到了 DCT，此前没有太关注，最近有对相关的原理进行学习了解，本文对 DCT 离散余弦变换相关的内容进行整理总结。<br>JPEG 使用的是 <strong>二维 DCT</strong>，因为它处理的是图像（二维信号）,理解二维 DCT 的基础是一维 DCT。</p>\n<h3 id=\"一维离散余弦变换\"><a href=\"#一维离散余弦变换\" class=\"headerlink\" title=\"一维离散余弦变换\"></a>一维离散余弦变换</h3><p>一维 DCT 将一个长度为 N 的信号序列（例如一行像素值）从空间域转换到频域。最常用的是 <strong>DCT-II</strong> 类型，这也是 JPEG 标准所使用的。</p>\n<p><strong>正变换：</strong> 从空间域到频域</p>\n<script type=\"math/tex; mode=display\">\n\nF(u) = C(u) \\sum_{x=0}^{N-1} f(x) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right]</script><p>其中：</p>\n<ul>\n<li><script type=\"math/tex\">f(x)</script>  是输入信号在位置 <script type=\"math/tex\">x</script> 的值（例如，像素亮度）。</li>\n<li><script type=\"math/tex\">F(u)</script>  是变换后得到的第 <script type=\"math/tex\">u</script> 个频率分量（DCT 系数）。</li>\n<li><script type=\"math/tex\">N</script>  是信号的长度（在 JPEG 中，通常是 8）。</li>\n<li><script type=\"math/tex\">u</script> 是频率索引，<script type=\"math/tex\">u = 0, 1, \\dots, N-1</script>。</li>\n<li><script type=\"math/tex\">x</script> 是空间位置索引，<script type=\"math/tex\">x = 0, 1, \\dots, N-1</script>。</li>\n<li><script type=\"math/tex\">C(u)</script> 是一个归一化系数，定义为：</li>\n</ul>\n<script type=\"math/tex; mode=display\">\n  C(u) = \\begin{cases}\n  \\sqrt{\\frac{1}{N}} & \\text{if } u = 0 \\\\\n  \\sqrt{\\frac{2}{N}} & \\text{if } u > 0\n  \\end{cases}</script><p><strong>关键点：</strong></p>\n<ul>\n<li>当 <script type=\"math/tex\">u = 0</script> 时，<script type=\"math/tex\">F(0)</script> 被称为 <strong>直流系数</strong>。它实际上是整个信号块的平均值。</li>\n<li>当 <script type=\"math/tex\">u > 0</script> 时，<script type=\"math/tex\">F(u)</script> 被称为 <strong>交流系数</strong>。它们代表了信号中不同频率的振荡模式。<script type=\"math/tex\">u</script> 越大，代表的频率越高。</li>\n</ul>\n<h3 id=\"二维离散余弦变换\"><a href=\"#二维离散余弦变换\" class=\"headerlink\" title=\"二维离散余弦变换\"></a>二维离散余弦变换</h3><p>JPEG 将图像分割成 8x8 的小块，然后对每个块独立进行二维 DCT。二维 DCT 可以看作先对每一行进行一维 DCT，然后再对每一列进行一维 DCT（顺序可互换）。</p>\n<p><strong>正变换：</strong> 从空间域到频域</p>\n<script type=\"math/tex; mode=display\">\n\nF(u, v) = C(u) C(v) \\sum_{x=0}^{N-1} \\sum_{y=0}^{N-1} f(x, y) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right] \\cdot \\cos\\left[\\frac{\\pi v (2y + 1)}{2N}\\right]</script><p>其中：</p>\n<ul>\n<li><script type=\"math/tex\">f(x, y)</script> 是 8x8 图像块中在位置 <script type=\"math/tex\">(x, y)</script> 的像素值。在计算前，通常会先将像素值减去 128（即 -128 到 127 的范围），使其围绕零对称。</li>\n<li><script type=\"math/tex\">F(u, v)</script> 是变换后得到的在频率 <script type=\"math/tex\">(u, v)</script> 上的 DCT 系数。</li>\n<li><script type=\"math/tex\">N = 8</script>（对于标准的 JPEG）。</li>\n<li><script type=\"math/tex\">u, v</script> 是频率索引，<script type=\"math/tex\">u, v = 0, 1, \\dots, 7</script>。</li>\n<li><script type=\"math/tex\">x, y</script> 是空间位置索引，<script type=\"math/tex\">x, y = 0, 1, \\dots, 7</script>。</li>\n<li><script type=\"math/tex\">C(u)</script> 和 <script type=\"math/tex\">C(v)</script> 的定义与一维情况相同：</li>\n</ul>\n<script type=\"math/tex; mode=display\">\n  C(u) = \\begin{cases}\n  \\sqrt{\\frac{1}{8}} & \\text{if } u = 0 \\\\\n  \\sqrt{\\frac{2}{8}} & \\text{if } u > 0\n  \\end{cases}</script><p>  同理于 <script type=\"math/tex\">C(v)</script>。</p>\n<p><strong>关键点：</strong></p>\n<ul>\n<li><script type=\"math/tex\">F(0, 0)</script> 是 <strong>直流系数</strong>，代表整个 8x8 块的平均亮度。</li>\n<li>所有其他的 <script type=\"math/tex\">F(u, v)</script> 都是 <strong>交流系数</strong>。</li>\n<li>系数 <script type=\"math/tex\">F(u, v)</script> 的 <script type=\"math/tex\">u</script> 和 <script type=\"math/tex\">v</script> 值越大，代表在水平和垂直方向上的频率越高。</li>\n<li>在变换后的 8x8 系数矩阵中，<strong>左上角是低频系数，右下角是高频系数</strong>。图像的大部分能量（信息）都集中在低频区域，这是 JPEG 能够实现高压缩比的关键。</li>\n</ul>\n<h3 id=\"逆离散余弦变换\"><a href=\"#逆离散余弦变换\" class=\"headerlink\" title=\"逆离散余弦变换\"></a>逆离散余弦变换</h3><p>为了从频域数据重建图像，需要使用逆 DCT。</p>\n<p><strong>逆变换：</strong> 从频域回到空间域</p>\n<script type=\"math/tex; mode=display\">\nf(x, y) = \\sum_{u=0}^{N-1} \\sum_{v=0}^{N-1} C(u) C(v) F(u, v) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right] \\cdot \\cos\\left[\\frac{\\pi v (2y + 1)}{2N}\\right]</script><p>公式中的各项含义与正变换完全相同。</p>\n<h3 id=\"简单理解\"><a href=\"#简单理解\" class=\"headerlink\" title=\"简单理解\"></a>简单理解</h3><p><strong>DCT的本质与核心直觉</strong></p>\n<p>DCT可以看作离散傅里叶变换（DFT）的一种特殊形式，主要处理实数信号，并且有很好的能量集中特性。</p>\n<p><strong>它的核心思想是</strong>：任何一个8x8的像素块，都可以看作是64种不同频率的标准余弦波（即“基础图案”）按照特定权重（也就是DCT系数）叠加而成的。<br><img src=\"https://ww2.mathworks.cn/help/images/basis8.gif\" alt=\"\"><br>在这些基础图案中：</p>\n<ul>\n<li><p>低频成分（对应于系数矩阵左上角，u和v值较小的部分）代表了图像块的大致轮廓和平滑变化的背景。</p>\n</li>\n<li><p>高频成分（对应于系数矩阵右下角，u和v值较大的部分）代表了图像块的细节、锐利边缘和纹理。</p>\n</li>\n</ul>\n<p>图像的大部分视觉能量（信息） 通常都集中在低频区域。这意味著，我们往往只需要少数几个大的低频系数，就能大致描述出图像块的主要样貌。</p>\n<p><strong>用二进制分解来类比DCT的能量集中</strong></p>\n<script type=\"math/tex; mode=display\">\n171=2^7+2^5+2^3+2^1+2^0</script><p>如果我们将所有的0系数也补上</p>\n<script type=\"math/tex; mode=display\">\n171=2^7+0*2^6+2^5+0*2^4+2^3+0*2^2+2^1+2^0</script><p>那么对应的系数数组为：[1,0,1,0,1,0,1,1]</p>\n<p>如果我们简单将数组低索引称之为”低频”，高索引为”高频”,将数据压缩只包含”低频”系数<br>[1,0,0,0,0,0,0,0]=&gt;2^7=128 大概丢了25%的信息<br>[1,0,1,0,0,0,0,0]=&gt;2^7+2^5=160 大概丢了6%的信息<br>[1,0,1,0,1,0,0,0]=&gt;2^7+2^5=160 大概丢了1%的信息<br>……</p>\n<p>可以看到“高频”信号对整个数据的影响比较小，这与DCT的思想不谋而合：我们保留对整体影响大的主要成分（低频系数），而舍弃或粗略表示那些影响细微的成分（高频系数），从而实现压缩。</p>\n<h3 id=\"总结-JPEG-压缩的流程\"><a href=\"#总结-JPEG-压缩的流程\" class=\"headerlink\" title=\"总结 JPEG 压缩的流程\"></a>总结 JPEG 压缩的流程</h3><ol>\n<li><strong>颜色空间转换</strong>：将图像从 RGB 转换到 YCbCr。</li>\n<li><strong>分块</strong>：将每个分量（Y, Cb, Cr）图像分割成 8x8 的块。</li>\n<li><strong>前向 DCT</strong>：对每个 8x8 块应用上述的二维 DCT 公式，得到频率系数。</li>\n<li><strong>量化</strong>：将 DCT 系数除以一个对应的量化步长（来自量化表），并四舍五入到整数。<strong>这一步是有损的，是信息丢失的主要来源</strong>。高频系数通常会被量化为 0。</li>\n<li><strong>熵编码</strong>：对量化后的系数进行 Zigzag 扫描、差分脉冲编码调制和霍夫曼编码，生成最终的 .jpg 文件。</li>\n</ol>\n<p>当解码时，过程是反过来的：熵解码 -&gt; 反量化 -&gt; 逆 DCT -&gt; 合并块 -&gt; 转换回 RGB。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p> <a href=\"https://zhuanlan.zhihu.com/p/40356456\">《影像算法解析——JPEG 压缩算法》</a><br> <a href=\"https://www.cnblogs.com/zxporz/p/16072580.html\">《白话文理解DCT离散余弦变换》</a><br> <a href=\"https://ww2.mathworks.cn/help/images/discrete-cosine-transform.html\">《离散余弦变换》</a><br> <strong>视频</strong><br> <a href=\"https://www.youtube.com/watch?v=0me3guauqOU\">The Unreasonable Effectiveness of JPEG: A Signal Processing Approach</a><br>中文翻译版本<a href=\"https://www.bilibili.com/video/BV1bc411q7YG/?spm_id_from=333.1387.favlist.content.click&amp;vd_source=3fd1362ef2060381db6c532cb37979dc\">《离散余弦变换可视化讲解》</a></p>\n","raw":"title: JPEG压缩之DCT离散余弦变换\nauthor: 落叶挽歌\nmathjax: true\ndate: 2025-11-04 22:25:17\ntags:\n  - 数学\ncategories:\n  - 算法研究\n---\n在[digital_video_introduction](https://github.com/leandromoreira/digital_video_introduction.git)的一节中讲解 [视频编解码器是如何工作的？](https://github.com/leandromoreira/digital_video_introduction/blob/master/README-cn.md#%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84)提到了 DCT，此前没有太关注，最近有对相关的原理进行学习了解，本文对 DCT 离散余弦变换相关的内容进行整理总结。\nJPEG 使用的是 **二维 DCT**，因为它处理的是图像（二维信号）,理解二维 DCT 的基础是一维 DCT。\n\n\n\n###  一维离散余弦变换\n\n一维 DCT 将一个长度为 N 的信号序列（例如一行像素值）从空间域转换到频域。最常用的是 **DCT-II** 类型，这也是 JPEG 标准所使用的。\n\n\n**正变换：** 从空间域到频域\n$$\n\nF(u) = C(u) \\sum_{x=0}^{N-1} f(x) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right]\n\n$$\n\n其中：\n\n- $$  f(x) $$  是输入信号在位置 $$ x $$ 的值（例如，像素亮度）。\n- $$  F(u) $$  是变换后得到的第 $$ u $$ 个频率分量（DCT 系数）。\n- $$   N $$  是信号的长度（在 JPEG 中，通常是 8）。\n- $$ u $$ 是频率索引，$$ u = 0, 1, \\dots, N-1 $$。\n- $$ x $$ 是空间位置索引，$$ x = 0, 1, \\dots, N-1 $$。\n- $$ C(u) $$ 是一个归一化系数，定义为：\n\n$$\n  C(u) = \\begin{cases}\n  \\sqrt{\\frac{1}{N}} & \\text{if } u = 0 \\\\\n  \\sqrt{\\frac{2}{N}} & \\text{if } u > 0\n  \\end{cases}\n$$\n\n**关键点：**\n- 当 $$ u = 0 $$ 时，$$ F(0) $$ 被称为 **直流系数**。它实际上是整个信号块的平均值。\n- 当 $$ u > 0 $$ 时，$$ F(u) $$ 被称为 **交流系数**。它们代表了信号中不同频率的振荡模式。$$ u $$ 越大，代表的频率越高。\n\n### 二维离散余弦变换\n\nJPEG 将图像分割成 8x8 的小块，然后对每个块独立进行二维 DCT。二维 DCT 可以看作先对每一行进行一维 DCT，然后再对每一列进行一维 DCT（顺序可互换）。\n\n**正变换：** 从空间域到频域\n$$\n\nF(u, v) = C(u) C(v) \\sum_{x=0}^{N-1} \\sum_{y=0}^{N-1} f(x, y) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right] \\cdot \\cos\\left[\\frac{\\pi v (2y + 1)}{2N}\\right]\n\n$$\n其中：\n- $$ f(x, y) $$ 是 8x8 图像块中在位置 $$ (x, y) $$ 的像素值。在计算前，通常会先将像素值减去 128（即 -128 到 127 的范围），使其围绕零对称。\n- $$ F(u, v) $$ 是变换后得到的在频率 $$ (u, v) $$ 上的 DCT 系数。\n- $$ N = 8 $$（对于标准的 JPEG）。\n- $$ u, v $$ 是频率索引，$$ u, v = 0, 1, \\dots, 7 $$。\n- $$ x, y $$ 是空间位置索引，$$ x, y = 0, 1, \\dots, 7 $$。\n- $$ C(u) $$ 和 $$ C(v) $$ 的定义与一维情况相同：\n\n$$\n  C(u) = \\begin{cases}\n  \\sqrt{\\frac{1}{8}} & \\text{if } u = 0 \\\\\n  \\sqrt{\\frac{2}{8}} & \\text{if } u > 0\n  \\end{cases}\n$$\n\n  同理于 $$ C(v) $$。\n\n**关键点：**\n- $$ F(0, 0) $$ 是 **直流系数**，代表整个 8x8 块的平均亮度。\n- 所有其他的 $$ F(u, v) $$ 都是 **交流系数**。\n- 系数 $$ F(u, v) $$ 的 $$ u $$ 和 $$ v $$ 值越大，代表在水平和垂直方向上的频率越高。\n- 在变换后的 8x8 系数矩阵中，**左上角是低频系数，右下角是高频系数**。图像的大部分能量（信息）都集中在低频区域，这是 JPEG 能够实现高压缩比的关键。\n\n### 逆离散余弦变换\n\n为了从频域数据重建图像，需要使用逆 DCT。\n\n**逆变换：** 从频域回到空间域\n$$\nf(x, y) = \\sum_{u=0}^{N-1} \\sum_{v=0}^{N-1} C(u) C(v) F(u, v) \\cdot \\cos\\left[\\frac{\\pi u (2x + 1)}{2N}\\right] \\cdot \\cos\\left[\\frac{\\pi v (2y + 1)}{2N}\\right]\n$$\n\n公式中的各项含义与正变换完全相同。\n\n### 简单理解\n\n\n**DCT的本质与核心直觉**\n\nDCT可以看作离散傅里叶变换（DFT）的一种特殊形式，主要处理实数信号，并且有很好的能量集中特性。\n\n**它的核心思想是**：任何一个8x8的像素块，都可以看作是64种不同频率的标准余弦波（即“基础图案”）按照特定权重（也就是DCT系数）叠加而成的。\n![](https://ww2.mathworks.cn/help/images/basis8.gif)\n在这些基础图案中：\n\n- 低频成分（对应于系数矩阵左上角，u和v值较小的部分）代表了图像块的大致轮廓和平滑变化的背景。\n\n- 高频成分（对应于系数矩阵右下角，u和v值较大的部分）代表了图像块的细节、锐利边缘和纹理。\n\n图像的大部分视觉能量（信息） 通常都集中在低频区域。这意味著，我们往往只需要少数几个大的低频系数，就能大致描述出图像块的主要样貌。\n\n**用二进制分解来类比DCT的能量集中**\n\n$$\n171=2^7+2^5+2^3+2^1+2^0\n$$\n如果我们将所有的0系数也补上\n$$\n171=2^7+0*2^6+2^5+0*2^4+2^3+0*2^2+2^1+2^0\n$$\n那么对应的系数数组为：[1,0,1,0,1,0,1,1]\n\n如果我们简单将数组低索引称之为\"低频\"，高索引为\"高频\",将数据压缩只包含\"低频\"系数 \n[1,0,0,0,0,0,0,0]=>2^7=128 大概丢了25%的信息\n[1,0,1,0,0,0,0,0]=>2^7+2^5=160 大概丢了6%的信息\n[1,0,1,0,1,0,0,0]=>2^7+2^5=160 大概丢了1%的信息\n……\n\n可以看到“高频”信号对整个数据的影响比较小，这与DCT的思想不谋而合：我们保留对整体影响大的主要成分（低频系数），而舍弃或粗略表示那些影响细微的成分（高频系数），从而实现压缩。\n\n\n### 总结 JPEG 压缩的流程\n\n1.  **颜色空间转换**：将图像从 RGB 转换到 YCbCr。\n2.  **分块**：将每个分量（Y, Cb, Cr）图像分割成 8x8 的块。\n3.  **前向 DCT**：对每个 8x8 块应用上述的二维 DCT 公式，得到频率系数。\n4.  **量化**：将 DCT 系数除以一个对应的量化步长（来自量化表），并四舍五入到整数。**这一步是有损的，是信息丢失的主要来源**。高频系数通常会被量化为 0。\n5.  **熵编码**：对量化后的系数进行 Zigzag 扫描、差分脉冲编码调制和霍夫曼编码，生成最终的 .jpg 文件。\n\n当解码时，过程是反过来的：熵解码 -> 反量化 -> 逆 DCT -> 合并块 -> 转换回 RGB。\n\n### 参考\n [《影像算法解析——JPEG 压缩算法》](https://zhuanlan.zhihu.com/p/40356456)\n [《白话文理解DCT离散余弦变换》](https://www.cnblogs.com/zxporz/p/16072580.html)\n [《离散余弦变换》](https://ww2.mathworks.cn/help/images/discrete-cosine-transform.html)\n **视频** \n [The Unreasonable Effectiveness of JPEG: A Signal Processing Approach](https://www.youtube.com/watch?v=0me3guauqOU)\n中文翻译版本[《离散余弦变换可视化讲解》](https://www.bilibili.com/video/BV1bc411q7YG/?spm_id_from=333.1387.favlist.content.click&vd_source=3fd1362ef2060381db6c532cb37979dc)","categories":[{"name":"算法研究","api":"api/categories/算法研究.json"}],"tags":[{"name":"数学","api":"api/tags/数学.json"}]},"api":"api/posts/2025/11/04/JPEG压缩之DCT离散余弦变换.json"}