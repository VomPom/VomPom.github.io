<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="è½å¶æŒ½æ­Œ"><title>KV-å­˜å‚¨ä¹‹mmkv | è½å¶æŒ½æ­Œ</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + 'a642bfb7c75afbc4fe68fd942180298b';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"><script src="/js/prism.js"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">KV-å­˜å‚¨ä¹‹mmkv</h1><a id="logo" href="/.">è½å¶æŒ½æ­Œ</a><p class="description">juliswang's åšå®¢</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">KV-å­˜å‚¨ä¹‹mmkv</h1><div class="post-meta">2025å¹´03æœˆ30æ—¥<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.3k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 21</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><p>åœ¨å¹³æ—¶çš„ä¸šåŠ¡ä¸­ï¼Œéœ€è¦ç”¨åˆ°è½»é‡çº§å­˜å‚¨ä¸šåŠ¡ä¸­çš„æ•°æ®ï¼ˆä¾‹å¦‚è®¾ç½®æ•°æ®å­˜å‚¨ï¼‰ï¼Œç»å¤§å¤šæ•°æ—¶å€™ Anroid ç®¡æ³•æä¾›çš„ <a href="https://developer.android.com/reference/android/content/SharedPreferences">SharedPreferences</a>  ç»„ä»¶å°±èƒ½å®ç°ï¼Œä½†é’ˆå¯¹ä¸€äº›éœ€è¦é«˜æ•ˆçš„åœºæ™¯å®ƒå°±ä¸é‚£ä¹ˆä½¿ç”¨äº†ï¼Œä¸é€‚åˆå­˜å‚¨å¤§é‡æ•°æ®ã€å¤šçº¿ç¨‹æ“ä½œçš„ä¸å®‰å…¨æ€§ã€æ•°æ®æ˜æ–‡ä¸å®‰å…¨æ€§ï¼Œä»¥åŠä¸æ”¯æŒå¤šè¿›ç¨‹ä¹‹é—´çš„è°ƒç”¨ç­‰å„ç§é—®é¢˜ã€‚<br><a href="https://github.com/Tencent/MMKV">MMKV</a>çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šçš„é—®é¢˜ï¼Œæœ¬æ–‡ä¸»è¦å¯¹ MMKV æºç çš„å­¦ä¹ çŸ¥è¯†ç‚¹è¿›è¡Œä¸€äº›æ€»ç»“ã€‚</p>
<h2 id="æ ¸å¿ƒè®¾è®¡ä¸åŸç†"><a href="#æ ¸å¿ƒè®¾è®¡ä¸åŸç†" class="headerlink" title="æ ¸å¿ƒè®¾è®¡ä¸åŸç†"></a>æ ¸å¿ƒè®¾è®¡ä¸åŸç†</h2><p>åœ¨å®˜æ–¹çš„å¼€æºå·¥ç¨‹ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ä¸€äº›ä»‹ç»</p>
<blockquote>
<p>MMKV æ˜¯åŸºäº mmap å†…å­˜æ˜ å°„çš„ key-value ç»„ä»¶ï¼Œåº•å±‚åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ä½¿ç”¨ protobuf å®ç°ï¼Œæ€§èƒ½é«˜ï¼Œç¨³å®šæ€§å¼ºã€‚ä» 2015 å¹´ä¸­è‡³ä»Šåœ¨å¾®ä¿¡ä¸Šä½¿ç”¨ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§ç»è¿‡äº†æ—¶é—´çš„éªŒè¯ã€‚</p>
</blockquote>
<h3 id="ä¼ ç»ŸI-Oä¸-mmap"><a href="#ä¼ ç»ŸI-Oä¸-mmap" class="headerlink" title="ä¼ ç»ŸI&#x2F;Oä¸ mmap"></a>ä¼ ç»ŸI&#x2F;Oä¸ mmap</h3><p>mmap è¿™ä¸ªæ˜¯ mmkv å®ç°çš„æ ¸å¿ƒï¼Œæ²¡æœ‰ mmap é‚£ä¹ˆå°±æ²¡æœ‰ mmkvã€‚å¯¹äº <code>SharedPreferences</code>çš„å®ç°æ¥è¯´ï¼Œæ¯æ¬¡çš„æ•°æ®æ›´æ–°éƒ½å°†æ“ä½œæœ¬åœ°æ–‡ä»¶ï¼Œè€Œæœ¬åœ°æ–‡ä»¶çš„å†™å…¥æ˜¯é€šè¿‡ä¼ ç»Ÿçš„I&#x2F;Oå®ç°ã€‚è¦ç†è§£ä¸¤è€…çš„å®ç°å·®å¼‚ï¼Œéœ€è¦å…ˆç†è§£ Linux <strong>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´</strong>è®¾è®¡ã€‚</p>
<h4 id="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"></a><strong>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´</strong></h4><p>Linuxçš„è¿›ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªè¿›ç¨‹æ˜¯ä¸èƒ½ç›´æ¥æ“ä½œæˆ–è€…è®¿é—®åˆ«ä¸€ä¸ªè¿›ç¨‹ç©ºé—´çš„ã€‚æ¯ä¸ªè¿›ç¨‹ç©ºé—´è¿˜åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ï¼ˆKernelï¼‰ç©ºé—´ï¼Œç›¸å½“äºæŠŠKernelå’Œä¸Šå±‚çš„åº”ç”¨ç¨‹åºæŠ½åƒçš„éš”ç¦»å¼€ã€‚</p>
<p><strong>ç”¨æˆ·ç©ºé—´</strong>å’Œ<strong>å†…æ ¸ç©ºé—´</strong>ï¼Œç”¨æˆ·ç©ºé—´æ˜¯ç”¨æˆ·ç¨‹åºä»£ç è¿è¡Œçš„åœ°æ–¹ï¼Œå†…æ ¸ç©ºé—´æ˜¯å†…æ ¸ä»£ç è¿è¡Œçš„åœ°æ–¹ã€‚ä¸ºäº†å®‰å…¨ï¼Œå®ƒä»¬æ˜¯éš”ç¦»çš„ï¼Œå³ä½¿ç”¨æˆ·çš„ç¨‹åºå´©æºƒäº†ï¼Œå†…æ ¸ä¹Ÿä¸å—å½±å“ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªéš”ç¦»ï¼Œä¸€ä¸ªè¿›ç¨‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼ŒäºŒæ˜¯è¿›ç¨‹å†…æœ‰ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„éš”ç¦»ã€‚</p>
<p>è¿›ç¨‹é—´ï¼Œç”¨æˆ·ç©ºé—´çš„æ•°æ®ä¸å¯å…±äº«ï¼Œæ‰€ä»¥ç”¨æˆ·ç©ºé—´ &#x3D; ä¸å¯å…±äº«ç©ºé—´<br>è¿›ç¨‹é—´ï¼Œå†…æ ¸ç©ºé—´çš„æ•°æ®å¯å…±äº«ï¼Œæ‰€ä»¥å†…æ ¸ç©ºé—´ &#x3D; å¯å…±äº«ç©ºé—´ï¼Œæ‰€ä»¥Linuxç³»ç»Ÿçš„å†…å­˜é€šå¸¸æ˜¯MemFree+Cache<br>æ‰€æœ‰è¿›ç¨‹å…±ç”¨1ä¸ªå†…æ ¸ç©ºé—´ã€‚</p>
<h4 id="ä¼ ç»ŸI-Oè¯»å†™æµç¨‹"><a href="#ä¼ ç»ŸI-Oè¯»å†™æµç¨‹" class="headerlink" title="ä¼ ç»ŸI&#x2F;Oè¯»å†™æµç¨‹"></a><strong>ä¼ ç»ŸI&#x2F;Oè¯»å†™æµç¨‹</strong></h4><p>å¸¸è§„æ–‡ä»¶è¯»å†™æ“ä½œï¼ˆè°ƒç”¨read&#x2F;freadç­‰å‡½æ•°ï¼‰è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>è¿›ç¨‹å‘èµ·è¯»å†™æ–‡ä»¶è¯·æ±‚ã€‚</p>
</li>
<li><p>å†…æ ¸é€šè¿‡æŸ¥æ‰¾è¿›ç¨‹æ–‡ä»¶ç¬¦è¡¨ï¼Œå®šä½åˆ°å†…æ ¸å·²æ‰“å¼€æ–‡ä»¶é›†ä¸Šçš„æ–‡ä»¶ä¿¡æ¯ï¼Œä»è€Œæ‰¾åˆ°æ­¤æ–‡ä»¶çš„<code>inode</code>ã€‚</p>
</li>
<li><p><code>inode</code> åœ¨ <code>address_space</code> ä¸ŠæŸ¥æ‰¾è¦è¯·æ±‚çš„æ–‡ä»¶é¡µæ˜¯å¦å·²ç»ç¼“å­˜åœ¨é¡µç¼“å­˜ä¸­ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›è¿™ç‰‡æ–‡ä»¶é¡µçš„å†…å®¹ã€‚</p>
</li>
<li><p>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡ <code>inode</code> å®šä½åˆ°æ–‡ä»¶ç£ç›˜åœ°å€ï¼Œå°†æ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°é¡µç¼“å­˜ã€‚ä¹‹åå†æ¬¡å‘èµ·è¯»é¡µé¢è¿‡ç¨‹ï¼Œè¿›è€Œå°†é¡µç¼“å­˜ä¸­çš„æ•°æ®å‘ç»™ç”¨æˆ·è¿›ç¨‹ã€‚</p>
<blockquote>
<p><strong>ä»€ä¹ˆæ˜¯ inode</strong> ?</p>
<p>å…¨ç§°ä¸º index nodeï¼Œæ—¢<strong>å­˜å‚¨æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸ</strong>ï¼Œä¸­æ–‡è¯‘åâ€œç´¢å¼•èŠ‚ç‚¹â€ã€‚<br>åŒ…å«ï¼šæ–‡ä»¶æƒé™ã€æ–‡ä»¶æ‹¥æœ‰è€…çš„UIDã€æ–‡ä»¶çš„å¤§å°ç­‰ç­‰ã€‚</p>
</blockquote>
</li>
</ul>
<img src="https://cdn.julis.wang/blog/img/ee519ba873acf3f80fd4ccec86ed72e7.png">


<p>æ€»ç»“æ¥è¯´ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œä¸ºäº†æé«˜è¯»å†™æ•ˆç‡å’Œä¿æŠ¤ç£ç›˜ï¼Œä½¿ç”¨äº†é¡µç¼“å­˜æœºåˆ¶ã€‚è¿™æ ·é€ æˆè¯»æ–‡ä»¶æ—¶éœ€è¦å…ˆå°†æ–‡ä»¶é¡µä»ç£ç›˜æ‹·è´åˆ°é¡µç¼“å­˜ä¸­ï¼Œç”±äºé¡µç¼“å­˜å¤„åœ¨å†…æ ¸ç©ºé—´ï¼Œä¸èƒ½è¢«ç”¨æˆ·è¿›ç¨‹ç›´æ¥å¯»å€è®¿é—®ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†é¡µç¼“å­˜ä¸­çš„æ•°æ®é¡µå†æ¬¡æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚è¿™æ ·ï¼Œé€šè¿‡äº†ä¸¤æ¬¡æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œæ‰èƒ½å®Œæˆ<strong>è¿›ç¨‹</strong>å¯¹<strong>æ–‡ä»¶</strong>å†…å®¹çš„è®¿é—®ã€‚</p>
<h4 id="mmapåŸºæœ¬æ¦‚å¿µå’ŒåŸç†"><a href="#mmapåŸºæœ¬æ¦‚å¿µå’ŒåŸç†" class="headerlink" title="mmapåŸºæœ¬æ¦‚å¿µå’ŒåŸç†"></a><strong>mmapåŸºæœ¬æ¦‚å¿µå’ŒåŸç†</strong></h4><p>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰ï¼Œå°±æ˜¯<strong>å°†æ–‡ä»¶çš„ç£ç›˜æ‰‡åŒºæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´</strong>çš„è¿‡ç¨‹ï¼Œå³å°†ä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚å®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨read,writeç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚</p>
<img src="https://cdn.julis.wang/blog/img/mmap_1.png">

<p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç”±å¤šä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸæ„æˆã€‚æ¯ä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸéƒ½æ˜¯è¿›ç¨‹åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä¸€ä¸ªåŒè´¨åŒºé—´ï¼Œå³å…·æœ‰åŒæ ·ç‰¹æ€§çš„è¿ç»­åœ°å€èŒƒå›´ã€‚ä¸Šå›¾ä¸­æ‰€ç¤ºçš„textæ•°æ®æ®µï¼ˆä»£ç æ®µï¼‰ã€åˆå§‹æ•°æ®æ®µã€BSSæ•°æ®æ®µã€å †ã€æ ˆå’Œå†…å­˜æ˜ å°„ï¼Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚å†…å­˜æ˜ å°„çš„åœ°å€ç©ºé—´å¤„åœ¨å †æ ˆä¹‹é—´çš„ç©ºä½™éƒ¨åˆ†ã€‚</p>
<p>linuxå†…æ ¸ä½¿ç”¨ <code>vm_area_struc</code>t ç»“æ„æ¥è¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œç”±äºæ¯ä¸ªä¸åŒè´¨çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸåŠŸèƒ½å’Œå†…éƒ¨æœºåˆ¶éƒ½ä¸åŒï¼Œå› æ­¤ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨å¤šä¸ª <code>vm_area_struct</code> ç»“æ„æ¥åˆ†åˆ«è¡¨ç¤ºä¸åŒç±»å‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚å„ä¸ª <code>vm_area_struct</code> ç»“æ„ä½¿ç”¨é“¾è¡¨æˆ–è€…æ ‘å½¢ç»“æ„é“¾æ¥ï¼Œæ–¹ä¾¿è¿›ç¨‹å¿«é€Ÿè®¿é—®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="https://cdn.julis.wang/blog/img/mmap_2_1.png">

<p><code>vm_area_struct</code> ç»“æ„ä¸­åŒ…å«åŒºåŸŸèµ·å§‹å’Œç»ˆæ­¢åœ°å€ä»¥åŠå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚è¿™æ ·ï¼Œè¿›ç¨‹å¯¹æŸä¸€è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„ä»»ä½•æ“ä½œéœ€è¦ç”¨è¦çš„ä¿¡æ¯ï¼Œéƒ½å¯ä»¥ä» <code>vm_area_struct</code> ä¸­è·å¾—ã€‚mmapå‡½æ•°å°±æ˜¯è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>vm_area_struct</code> ç»“æ„ï¼Œå¹¶å°†å…¶ä¸æ–‡ä»¶çš„ç‰©ç†ç£ç›˜åœ°å€ç›¸è¿ã€‚</p>
<p>mmapå†…å­˜æ˜ å°„çš„å®ç°è¿‡ç¨‹ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><strong>é˜¶æ®µä¸€ï¼šè¿›ç¨‹å¯åŠ¨æ˜ å°„è¿‡ç¨‹ï¼Œå¹¶åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºæ˜ å°„åˆ›å»ºè™šæ‹Ÿæ˜ å°„åŒºåŸŸ</strong></p>
<ul>
<li>è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è°ƒç”¨mmapåº“å‡½æ•°</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags, <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>addr</code>ï¼šæŒ‡å®šæ˜ å°„çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œå¯ä»¥è®¾ç½®ä¸º NULLï¼Œè®©å†…æ ¸è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„è™šæ‹Ÿå†…å­˜åœ°å€</p>
<p><code>length</code>ï¼šæ˜ å°„çš„é•¿åº¦ã€‚</p>
<p><code>prot</code>ï¼šæ˜ å°„å†…å­˜çš„ä¿æŠ¤æ¨¡å¼ï¼Œå¯é€‰å€¼å¦‚ä¸‹ï¼š  </p>
<p><code>flags</code>ï¼šæŒ‡å®šæ˜ å°„çš„ç±»å‹</p>
<p><code>fd</code>ï¼šè¿›è¡Œæ˜ å°„çš„æ–‡ä»¶å¥æŸ„ã€‚</p>
<p><code>offset</code>ï¼šæ–‡ä»¶åç§»é‡ï¼ˆä»æ–‡ä»¶çš„ä½•å¤„å¼€å§‹æ˜ å°„ï¼‰</p>
<ul>
<li><p>åœ¨å½“å‰è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¯»æ‰¾ä¸€æ®µç©ºé—²çš„æ»¡è¶³è¦æ±‚çš„è¿ç»­çš„è™šæ‹Ÿåœ°å€</p>
</li>
<li><p>ä¸ºæ­¤è™šæ‹ŸåŒºåˆ†é…ä¸€ä¸ª <code>vm_area_struct</code> ç»“æ„ï¼Œæ¥ç€å¯¹è¿™ä¸ªç»“æ„çš„å„ä¸ªåŸŸè¿›è¡Œäº†åˆå§‹åŒ–</p>
</li>
<li><p>å°†æ–°åˆ›å»ºçš„è™šæ‹ŸåŒºç»“æ„ <code>vm_area_struct</code> å¯¹è±¡æ’å…¥åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€åŒºåŸŸé“¾è¡¨&#x2F;æ ‘ä¸­</p>
</li>
</ul>
<p><strong>é˜¶æ®µäºŒï¼šè°ƒç”¨å†…æ ¸ç©ºé—´çš„mmapå‡½æ•°ï¼ˆä¸åŒäºç”¨æˆ·ç©ºé—´å‡½æ•°ï¼‰ï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„å…³ç³»</strong></p>
<ul>
<li><p>ä¸ºæ˜ å°„åˆ†é…äº†æ–°çš„è™šæ‹Ÿåœ°å€åŒºåŸŸåï¼Œé€šè¿‡å¾…æ˜ å°„çš„æ–‡ä»¶æŒ‡é’ˆï¼Œåœ¨æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œé“¾æ¥åˆ°å†…æ ¸â€œå·²æ‰“å¼€æ–‡ä»¶é›†â€ä¸­è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„ä½“ï¼ˆstruct fileï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶ç»“æ„ä½“ç»´æŠ¤ç€å’Œè¿™ä¸ªå·²æ‰“å¼€æ–‡ä»¶ç›¸å…³å„é¡¹ä¿¡æ¯ã€‚</p>
</li>
<li><p>ä¸ºæ˜ å°„åˆ†é…äº†æ–°çš„è™šæ‹Ÿåœ°å€åŒºåŸŸåï¼Œé€šè¿‡å¾…æ˜ å°„çš„æ–‡ä»¶æŒ‡é’ˆï¼Œåœ¨æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œé“¾æ¥åˆ°å†…æ ¸â€œå·²æ‰“å¼€æ–‡ä»¶é›†â€ä¸­è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„ä½“ï¼ˆstruct fileï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶ç»“æ„ä½“ç»´æŠ¤ç€å’Œè¿™ä¸ªå·²æ‰“å¼€æ–‡ä»¶ç›¸å…³å„é¡¹ä¿¡æ¯ã€‚</p>
</li>
<li><p>é€šè¿‡è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„ä½“ï¼Œé“¾æ¥åˆ° <code>file_operations</code> æ¨¡å—ï¼Œè°ƒç”¨å†…æ ¸mmapå‡½æ•°ï¼Œå…¶åŸå‹ä¸ºï¼š</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int mmap(struct file *filp, struct vm_area_struct *vma) //ä¸åŒäºç”¨æˆ·ç©ºé—´mmapåº“å‡½æ•°</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å†…æ ¸mmapå‡½æ•°é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿinodeæ¨¡å—å®šä½åˆ°æ–‡ä»¶ç£ç›˜ç‰©ç†åœ°å€ã€‚</p>
</li>
<li><p>é€šè¿‡ <code>remap_pfn_range</code> å‡½æ•°å»ºç«‹é¡µè¡¨ï¼Œå³å®ç°äº†æ–‡ä»¶åœ°å€å’Œè™šæ‹Ÿåœ°å€åŒºåŸŸçš„æ˜ å°„å…³ç³»ã€‚æ­¤æ—¶ï¼Œè¿™ç‰‡è™šæ‹Ÿåœ°å€å¹¶æ²¡æœ‰ä»»ä½•æ•°æ®å…³è”åˆ°ç‰©ç†å†…å­˜(ä¸»å­˜)ä¸­ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¸»å­˜</p>
<p>ä¸»å­˜å‚¨å™¨ï¼ˆMain memoryï¼‰ï¼Œç®€ç§°ä¸»å­˜ã€‚æ˜¯è®¡ç®—æœºç¡¬ä»¶çš„ä¸€ä¸ªé‡è¦éƒ¨ä»¶ï¼Œå…¶ä½œç”¨æ˜¯å­˜æ”¾æŒ‡ä»¤å’Œæ•°æ®ï¼Œå¹¶èƒ½ç”±ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ç›´æ¥éšæœºå­˜å–</p>
</blockquote>
<p><strong>é˜¶æ®µä¸‰ï¼šè¿›ç¨‹å‘èµ·å¯¹è¿™ç‰‡æ˜ å°„åœ°å€ç©ºé—´çš„è®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰çš„æ‹·è´</strong></p>
<blockquote>
<p>å‰ä¸¤ä¸ªé˜¶æ®µä»…åœ¨äºåˆ›å»ºè™šæ‹ŸåŒºé—´å¹¶å®Œæˆåœ°å€æ˜ å°„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å°†ä»»ä½•æ–‡ä»¶æ•°æ®çš„æ‹·è´è‡³ä¸»å­˜ã€‚çœŸæ­£çš„æ–‡ä»¶è¯»å–æ˜¯å½“è¿›ç¨‹å‘èµ·è¯»æˆ–å†™æ“ä½œæ—¶</p>
</blockquote>
<ul>
<li><p>è¿›ç¨‹çš„è¯»æˆ–å†™æ“ä½œè®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´è¿™ä¸€æ®µæ˜ å°„åœ°å€ï¼Œé€šè¿‡æŸ¥è¯¢é¡µè¡¨ï¼Œå‘ç°è¿™ä¸€æ®µåœ°å€å¹¶ä¸åœ¨ç‰©ç†é¡µä¸Šã€‚å› ä¸ºç›®å‰åªå»ºç«‹äº†åœ°å€æ˜ å°„ï¼ŒçœŸæ­£çš„ç¡¬ç›˜æ•°æ®è¿˜æ²¡æœ‰æ‹·è´åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤å¼•å‘ç¼ºé¡µå¼‚å¸¸ã€‚</p>
</li>
<li><p>ç¼ºé¡µå¼‚å¸¸è¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­ï¼Œç¡®å®šæ— éæ³•æ“ä½œåï¼Œå†…æ ¸å‘èµ·è¯·æ±‚è°ƒé¡µè¿‡ç¨‹ã€‚</p>
</li>
<li><p>è°ƒé¡µè¿‡ç¨‹å…ˆåœ¨äº¤æ¢ç¼“å­˜ç©ºé—´ï¼ˆswap cacheï¼‰ä¸­å¯»æ‰¾éœ€è¦è®¿é—®çš„å†…å­˜é¡µï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨nopageå‡½æ•°æŠŠæ‰€ç¼ºçš„é¡µä»ç£ç›˜è£…å…¥åˆ°ä¸»å­˜ä¸­ã€‚</p>
</li>
<li><p>ä¹‹åè¿›ç¨‹å³å¯å¯¹è¿™ç‰‡ä¸»å­˜è¿›è¡Œè¯»æˆ–è€…å†™çš„æ“ä½œï¼Œå¦‚æœå†™æ“ä½œæ”¹å˜äº†å…¶å†…å®¹ï¼Œä¸€å®šæ—¶é—´åç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”ç£ç›˜åœ°å€ï¼Œä¹Ÿå³å®Œæˆäº†å†™å…¥åˆ°æ–‡ä»¶çš„è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¿®æ”¹è¿‡çš„è„é¡µé¢å¹¶ä¸ä¼šç«‹å³æ›´æ–°å›æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æœ‰ä¸€æ®µæ—¶é—´çš„å»¶è¿Ÿï¼Œå¯ä»¥è°ƒç”¨<code>msync()</code>æ¥å¼ºåˆ¶åŒæ­¥, è¿™æ ·æ‰€å†™çš„å†…å®¹å°±èƒ½ç«‹å³ä¿å­˜åˆ°æ–‡ä»¶é‡Œäº†</p>
</blockquote>
<p>å¸¸è§„æ–‡ä»¶æ“ä½œéœ€è¦ä»ç£ç›˜åˆ°å†…æ ¸ç©ºé—´é¡µç¼“å­˜å†åˆ°ç”¨æˆ·ç©ºé—´ä¸»å­˜çš„ä¸¤æ¬¡æ•°æ®æ‹·è´ã€‚è€Œmmapæ–‡ä»¶æ˜ å°„ï¼Œåªéœ€è¦ä»ç£ç›˜åˆ°ç”¨æˆ·ç©ºé—´ä¸»å­˜çš„ä¸€æ¬¡æ•°æ®æ‹·è´è¿‡ç¨‹ã€‚mmapçš„å…³é”®ç‚¹æ˜¯å®ç°äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ•°æ®ç›´æ¥äº¤äº’è€Œçœå»äº†ç©ºé—´ä¸åŒæ•°æ®ä¸é€šçš„ç¹çè¿‡ç¨‹ï¼Œå› æ­¤ mmap æ•ˆç‡æ›´é«˜ã€‚</p>
<p>ä»¥ä¸Šæ˜¯ mmap çš„åŸºæœ¬æ¦‚å¿µå’ŒåŸç†ï¼Œææ˜ç™½äº†è¿™äº›æ‰èƒ½çœ‹æ˜ç™½æ•´ä¸ª mmkv é‡Œé¢çš„é€»è¾‘å¤„ç†</p>
<h3 id="mmkv-ä¸€æ¬¡-put-çš„æµç¨‹"><a href="#mmkv-ä¸€æ¬¡-put-çš„æµç¨‹" class="headerlink" title="mmkv ä¸€æ¬¡ put çš„æµç¨‹"></a>mmkv ä¸€æ¬¡ put çš„æµç¨‹</h3><p>mmkvåˆå§‹åŒ–æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸€äº›é…ç½®çš„åˆå§‹åŒ–ï¼Œæ–‡ä»¶å¤¹åˆ›å»ºç­‰ï¼Œå…¶ä¸­æœ€é‡è¦çš„é€»è¾‘ mmap è°ƒç”¨è¢«å°è£…åˆ°ä¸€ä¸ª <code>MemoryFile</code>åˆ°å¯¹è±¡é‡Œé¢ </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MemoryFile::mmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> oldPtr = m_ptr;</span><br><span class="line">    <span class="keyword">auto</span> mode = m_readOnly ? PROT_READ : (PROT_READ | PROT_WRITE);</span><br><span class="line">    m_ptr = (<span class="type">char</span> *) ::<span class="built_in">mmap</span>(m_ptr, m_size, mode, MAP_SHARED, m_diskFile.m_fd, <span class="number">0</span>);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦è®°å½•ä¸€ä¸‹ä¸€æ¬¡ put ä»»åŠ¡çš„æµç¨‹ï¼Œä»¥ <code>mmkv.putInt(&quot;int&quot;, 1)</code>ä¸ºä¾‹ï¼Œè¿›è¿‡ JNI çš„è°ƒç”¨åˆ°äº†</p>
<p><strong>native-birdge.cpp</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">MMKV_JNI jboolean <span class="title">encodeInt</span><span class="params">(JNIEnv *env, jobject obj, jlong handle, jstring oKey, jint value)</span> </span>&#123;</span><br><span class="line">    MMKV *kv = <span class="built_in">reinterpret_cast</span>&lt;MMKV *&gt;(handle);</span><br><span class="line">    <span class="keyword">if</span> (kv &amp;&amp; oKey) &#123;</span><br><span class="line">        string key = <span class="built_in">jstring2string</span>(env, oKey);</span><br><span class="line">        <span class="keyword">return</span> (jboolean) kv-&gt;<span class="built_in">set</span>((<span class="type">int32_t</span>) value, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (jboolean) <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥äº†<strong>MMVK.cpp</strong>çš„ </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MMKV::set</span><span class="params">(<span class="type">int32_t</span> value, MMKVKey_t key, <span class="type">uint32_t</span> expireDuration)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isKeyEmpty</span>(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">size_t</span> size = <span class="built_in">mmkv_unlikely</span>(m_enableKeyExpire) ? Fixed32Size + <span class="built_in">pbInt32Size</span>(value) : <span class="built_in">pbInt32Size</span>(value);</span><br><span class="line">    <span class="function">MMBuffer <span class="title">data</span><span class="params">(size)</span></span>;</span><br><span class="line">    <span class="function">CodedOutputData <span class="title">output</span><span class="params">(data.getPtr(), size)</span></span>;</span><br><span class="line">    output.<span class="built_in">writeInt32</span>(value);</span><br><span class="line">    <span class="comment">// ... çœç•¥ä¸€äº›æ ¡éªŒé€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">setDataForKey</span>(std::<span class="built_in">move</span>(data), key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯å‡†å¤‡ä¸€ä¸‹æ•°æ®ï¼Œå¹¶ä½¿ç”¨ <code>MMBuffer</code> <code>CodedOutputData</code>å°†å†™å…¥çš„æ•°æ®è¿›è¡Œä¸€æ¬¡åŒ…è£…ï¼ˆä¸ä»…ä»…æ˜¯ key-valueï¼Œè¿˜æœ‰æ•°æ®sizeç­‰ç­‰ï¼‰ï¼Œå®é™…è°ƒç”¨åœ¨<code>setDataForKey</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MMKV::setDataForKey</span><span class="params">(MMBuffer &amp;&amp;data, MMKVKey_t key, <span class="type">bool</span> isDataHolder)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">checkLoadData</span>(); <span class="comment">// çŠ¶æ€åŒæ­¥ç›¸å…³çš„é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">      <span class="comment">// ... çœç•¥åŠ å¯†çš„å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> itr = m_dic-&gt;<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (itr != m_dic-&gt;<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="comment">// compare data before appending to file</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isCompareBeforeSetEnabled</span>()) &#123;</span><br><span class="line">                <span class="keyword">auto</span> basePtr = (<span class="type">uint8_t</span> *) (m_file-&gt;<span class="built_in">getMemory</span>()) + Fixed32Size;</span><br><span class="line">                MMBuffer oldValueData = itr-&gt;second.<span class="built_in">toMMBuffer</span>(basePtr);</span><br><span class="line">                <span class="keyword">if</span> (isDataHolder) &#123;</span><br><span class="line">                    <span class="function">CodedInputData <span class="title">inputData</span><span class="params">(oldValueData.getPtr(), oldValueData.length())</span></span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// read extra holder header bytes and to real MMBuffer</span></span><br><span class="line">                        oldValueData = CodedInputData::<span class="built_in">readRealData</span>(oldValueData);</span><br><span class="line">                        <span class="keyword">if</span> (oldValueData == data) &#123;</span><br><span class="line">                            <span class="comment">// MMKVInfo(&quot;[key] %s, set the same data&quot;, key.c_str());</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="built_in">catch</span> (std::exception &amp;exception) &#123;</span><br><span class="line">                        <span class="built_in">MMKVWarning</span>(<span class="string">&quot;compareBeforeSet exception: %s&quot;</span>, exception.<span class="built_in">what</span>());</span><br><span class="line">                    &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">                        <span class="built_in">MMKVWarning</span>(<span class="string">&quot;compareBeforeSet fail&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     ...</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">bool</span> onlyOneKey = !<span class="built_in">isMultiProcess</span>() &amp;&amp; m_dic-&gt;<span class="built_in">size</span>() == <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">mmkv_likely</span>(!m_enableKeyExpire)) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                KVHolderRet_t ret;</span><br><span class="line">                <span class="keyword">if</span> (onlyOneKey) &#123;</span><br><span class="line">                    ret = <span class="built_in">overrideDataWithKey</span>(data, key, isDataHolder);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ret = <span class="built_in">appendDataWithKey</span>(data, key, isDataHolder);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!ret.first) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                itr = m_dic-&gt;<span class="built_in">find</span>(key);</span><br><span class="line">                <span class="keyword">if</span> (itr != m_dic-&gt;<span class="built_in">end</span>()) &#123;</span><br><span class="line">                    itr-&gt;second = std::<span class="built_in">move</span>(ret.second);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// in case filterExpiredKeys() is triggered</span></span><br><span class="line">                    m_dic-&gt;<span class="built_in">emplace</span>(key, std::<span class="built_in">move</span>(ret.second));</span><br><span class="line">                    <span class="built_in">mmkv_retain_key</span>(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    m_hasFullWriteback = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢çš„ä»£ç é€»è¾‘å¾ˆé•¿ï¼Œåšäº†å¾ˆå¤š if-else çš„é€»è¾‘ï¼Œæœ€ç»ˆèµ°å‘ä¸¤ä¸ªå¤§åˆ†æ”¯ï¼š</p>
<p>key æ˜¯æ–°å¢çš„èµ° <code>appendDataWithKey</code></p>
<p>key å°†ä¼šè¦†ç›–åŸæ¥çš„å°†ä¼šèµ° <code>overrideDataWithKey</code></p>
<p>æœ‰è¿™ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸»è¦æ˜¯å› ä¸º mmkv å­˜å‚¨é‡‡ç”¨çš„  <a href="https://protobuf.com.cn/">protobuf åè®®</a>ï¼Œå¦å¤–æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•ä¹Ÿåœ¨è¿™é‡Œæ‰§è¡Œäº†ï¼š<code>checkLoadData();</code>  å®‰å“é‡Œé¢çš„å¤šè¿›ç¨‹å®ç°ï¼Œå°†éœ€è¦è¿™é‡Œçš„ä¸€äº›é€»è¾‘ï¼Œåœ¨ mmkvå¤šè¿›ç¨‹åŸç†ç¯‡è¿›è¡Œè®²è§£ã€‚</p>
<p><code>appendDataWithKey</code> è½¬æ¢ä¸º <code>MMBuffer</code>å¹¶ç»§ç»­å‘ä¸‹æ‰§è¡Œ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">KVHolderRet_t <span class="title">MMKV::appendDataWithKey</span><span class="params">(<span class="type">const</span> MMBuffer &amp;data, MMKVKey_t key, <span class="type">bool</span> isDataHolder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> keyData = <span class="built_in">MMBuffer</span>((<span class="type">void</span> *) key.<span class="built_in">data</span>(), key.<span class="built_in">size</span>(), MMBufferNoCopy);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">doAppendDataWithKey</span>(data, keyData, isDataHolder, <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(keyData.<span class="built_in">length</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>doAppendDataWithKey</code> é‡Œé¢çš„ä»£ç ä¹Ÿå¾ˆé•¿ï¼Œä¸è¿‡ä¹Ÿå°±åªåšä¸€ä»¶äº‹ï¼šå°†k-vå€¼å†™å…¥åˆ°æ–‡ä»¶é‡Œé¢åšå‡†å¤‡ï¼ŒçœŸæ­£çš„å†™å…¥é€»è¾‘åœ¨ <code>m_output-&gt;writeData(keyData);</code>ï¼Œè¿™é‡Œå…ˆåè°ƒç”¨äº†ä¸¤æ¬¡ <code>writeData</code>,æ˜¯å…ˆå†™å…¥keyå†å†™å…¥äº† valueã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">KVHolderRet_t</span></span><br><span class="line"><span class="function"><span class="title">MMKV::doAppendDataWithKey</span><span class="params">(<span class="type">const</span> MMBuffer &amp;data, <span class="type">const</span> MMBuffer &amp;keyData, <span class="type">bool</span> isDataHolder, <span class="type">uint32_t</span> originKeyLength)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> isKeyEncoded = (originKeyLength &lt; keyData.<span class="built_in">length</span>());</span><br><span class="line">    <span class="keyword">auto</span> keyLength = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(keyData.<span class="built_in">length</span>());</span><br><span class="line">    <span class="keyword">auto</span> valueLength = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(data.<span class="built_in">length</span>());</span><br><span class="line">    <span class="keyword">if</span> (isDataHolder) &#123;</span><br><span class="line">        valueLength += <span class="built_in">pbRawVarint32Size</span>(valueLength);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// size needed to encode the key</span></span><br><span class="line">    <span class="type">size_t</span> size = isKeyEncoded ? keyLength : (keyLength + <span class="built_in">pbRawVarint32Size</span>(keyLength));</span><br><span class="line">    <span class="comment">// size needed to encode the value</span></span><br><span class="line">    size += valueLength + <span class="built_in">pbRawVarint32Size</span>(valueLength);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">SCOPED_LOCK</span>(m_exclusiveProcessLock);</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> hasEnoughSize = <span class="built_in">ensureMemorySize</span>(size);</span><br><span class="line">    <span class="keyword">if</span> (!hasEnoughSize || !<span class="built_in">isFileValid</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="literal">false</span>, <span class="built_in">KeyValueHolder</span>());</span><br><span class="line">    &#125;</span><br><span class="line">		...</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isKeyEncoded) &#123;</span><br><span class="line">            m_output-&gt;<span class="built_in">writeRawData</span>(keyData);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            m_output-&gt;<span class="built_in">writeData</span>(keyData);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isDataHolder) &#123;</span><br><span class="line">            m_output-&gt;<span class="built_in">writeRawVarint32</span>((<span class="type">int32_t</span>) valueLength);</span><br><span class="line">        &#125;</span><br><span class="line">        m_output-&gt;<span class="built_in">writeData</span>(data); <span class="comment">// note: write size of data</span></span><br><span class="line">    &#125; </span><br><span class="line">    ...</span><br><span class="line">    m_actualSize += size;</span><br><span class="line">    <span class="built_in">updateCRCDigest</span>(ptr, size);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">make_pair</span>(<span class="literal">true</span>, <span class="built_in">KeyValueHolder</span>(originKeyLength, valueLength, offset));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>writeData</code> è¿›è¡Œäº†ä¸¤æ­¥å…ˆå†™å…¥æ•°æ®çš„ <strong>é•¿åº¦ä¿¡æ¯</strong>ï¼Œå†å†™å…¥çœŸå®çš„æ•°æ®ï¼Œè¿™é‡Œè¿˜æ˜¯å› ä¸º  <a href="https://protobuf.com.cn/">protobuf åè®®</a>è®¾è®¡ç›¸å…³</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CodedOutputData::writeData</span><span class="params">(<span class="type">const</span> MMBuffer &amp;value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">writeRawVarint32</span>((<span class="type">int32_t</span>) value.<span class="built_in">length</span>());</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">writeRawData</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆèµ°åˆ°äº†<code>writeRawData</code> å…³é”®ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CodedOutputData::writeRawData</span><span class="params">(<span class="type">const</span> MMBuffer &amp;data)</span> </span>&#123;</span><br><span class="line">    <span class="type">size_t</span> numberOfBytes = data.<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">if</span> (m_position + numberOfBytes &gt; m_size) &#123;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memcpy</span>(m_ptr + m_position, data.<span class="built_in">getPtr</span>(), numberOfBytes);</span><br><span class="line">    m_position += numberOfBytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒé€»è¾‘ä½¿ç”¨ <code>memcpy</code> å°†æ•°æ®ç›´æ¥é€šè¿‡ memcpy ç›´æ¥åœ¨å†…å­˜å±‚é¢è¿›è¡Œæ‹·è´ï¼Œè€Œè¿™é‡Œçš„ <code>m_ptr</code>å°±æ˜¯æœ€å¼€å§‹é€šè¿‡<code>mmap</code>åˆ›å»ºå‡ºæ¥çš„æŒ‡é’ˆï¼ï¼åˆ°è¿™é‡Œä¸€æ¬¡å†™å…¥åŸºæœ¬ä¸Šå°±ç»“æŸäº†ã€‚</p>
<h3 id="mmkv-ä¸€æ¬¡-get-çš„æµç¨‹"><a href="#mmkv-ä¸€æ¬¡-get-çš„æµç¨‹" class="headerlink" title="mmkv ä¸€æ¬¡ get çš„æµç¨‹"></a>mmkv ä¸€æ¬¡ get çš„æµç¨‹</h3><p>ä¾ç„¶å…ˆé€šè¿‡ JNIèµ°åˆ°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">MMKV_JNI jint <span class="title">decodeInt</span><span class="params">(JNIEnv *env, jobject obj, jlong handle, jstring oKey, jint defaultValue)</span> </span>&#123;</span><br><span class="line">    MMKV *kv = <span class="built_in">reinterpret_cast</span>&lt;MMKV *&gt;(handle);</span><br><span class="line">    <span class="keyword">if</span> (kv &amp;&amp; oKey) &#123;</span><br><span class="line">        string key = <span class="built_in">jstring2string</span>(env, oKey);</span><br><span class="line">        <span class="keyword">return</span> (jint) kv-&gt;<span class="built_in">getInt32</span>(key, defaultValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†åˆ° mmkv getInt32</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">MMKV::getInt32</span><span class="params">(MMKVKey_t key, <span class="type">int32_t</span> defaultValue, <span class="type">bool</span> *hasValue)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">    <span class="built_in">SCOPED_LOCK</span>(m_lock);</span><br><span class="line">    <span class="built_in">SCOPED_LOCK</span>(m_sharedProcessLock);</span><br><span class="line">    <span class="keyword">auto</span> data = <span class="built_in">getDataForKey</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="built_in">length</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="function">CodedInputData <span class="title">input</span><span class="params">(data.getPtr(), data.length())</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (hasValue != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">                *hasValue = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> input.<span class="built_in">readInt32</span>();</span><br><span class="line">        &#125; </span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">return</span> defaultValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getRawDataForKey</code>æ–¹æ³•ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ç§æ˜¯åŠ å¯†é€»è¾‘ï¼Œå¦ä¸€ç§æ˜¯éåŠ å¯†é€»è¾‘ï¼Œä½†ä»–ä»¬æµç¨‹éƒ½å·®ä¸å¤šä»ä¸€ä¸ª  map é‡Œé¢æ ¹æ® key è·å–ä¸€ä¸ªå¯¹è±¡ï¼ˆè¿™ä¸ªå¯¹è±¡æš‚æ—¶å¹¶ä¸æ˜¯ get æœ€ç»ˆçš„è¿”å›å€¼ï¼‰ï¼Œé‚£è¿™ä¸ª map æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">MMBuffer <span class="title">MMKV::getRawDataForKey</span><span class="params">(MMKVKey_t key)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">checkLoadData</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MMKV_DISABLE_CRYPT</span></span><br><span class="line">    <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">        <span class="keyword">auto</span> itr = m_dicCrypt-&gt;<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (itr != m_dicCrypt-&gt;<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> basePtr = (<span class="type">uint8_t</span> *) (m_file-&gt;<span class="built_in">getMemory</span>()) + Fixed32Size;</span><br><span class="line">            <span class="keyword">return</span> itr-&gt;second.<span class="built_in">toMMBuffer</span>(basePtr, m_crypter);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> itr = m_dic-&gt;<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (itr != m_dic-&gt;<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> basePtr = (<span class="type">uint8_t</span> *) (m_file-&gt;<span class="built_in">getMemory</span>()) + Fixed32Size;</span><br><span class="line">            <span class="keyword">return</span> itr-&gt;second.<span class="built_in">toMMBuffer</span>(basePtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    MMBuffer nan;</span><br><span class="line">    <span class="keyword">return</span> nan;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç é‡Œé¢æº¯æº<code>m_dicCrypt</code>å’Œ <code>m_dic</code> æ˜¯åœ¨ MMKV åˆå§‹åŒ–çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œä¸»è¦é€»è¾‘åœ¨ <code>MMKV_IO .cpp</code>é‡Œé¢çš„ <code>loadFromFile</code>æ–¹æ³•å†…ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MMKV::loadFromFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">loadMetaInfoAndCheck</span>();</span><br><span class="line">		...</span><br><span class="line">    <span class="keyword">if</span> (!m_file-&gt;<span class="built_in">isFileValid</span>()) &#123;</span><br><span class="line">        m_file-&gt;<span class="built_in">reloadFromFile</span>(m_expectedCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!m_file-&gt;<span class="built_in">isFileValid</span>()) &#123;</span><br><span class="line">        <span class="built_in">MMKVError</span>(<span class="string">&quot;file [%s] not valid&quot;</span>, m_path.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">bool</span> loadFromFile = <span class="literal">false</span>, needFullWriteback = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">checkDataValid</span>(loadFromFile, needFullWriteback);</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">auto</span> ptr = (<span class="type">uint8_t</span> *) m_file-&gt;<span class="built_in">getMemory</span>();</span><br><span class="line">        <span class="comment">// loading</span></span><br><span class="line">        <span class="keyword">if</span> (loadFromFile &amp;&amp; m_actualSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				...</span><br><span class="line">            <span class="function">MMBuffer <span class="title">inputBuffer</span><span class="params">(ptr + Fixed32Size, m_actualSize, MMBufferNoCopy)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">                <span class="built_in">clearDictionary</span>(m_dicCrypt);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">clearDictionary</span>(m_dic);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (needFullWriteback) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MMKV_DISABLE_CRYPT</span></span><br><span class="line">                <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">                    MiniPBCoder::<span class="built_in">greedyDecodeMap</span>(*m_dicCrypt, inputBuffer, m_crypter);</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">                &#123;</span><br><span class="line">                    MiniPBCoder::<span class="built_in">greedyDecodeMap</span>(*m_dic, inputBuffer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MMKV_DISABLE_CRYPT</span></span><br><span class="line">                <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">                    MiniPBCoder::<span class="built_in">decodeMap</span>(*m_dicCrypt, inputBuffer, m_crypter);</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">                &#123;</span><br><span class="line">                    MiniPBCoder::<span class="built_in">decodeMap</span>(*m_dic, inputBuffer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            m_output = <span class="keyword">new</span> <span class="built_in">CodedOutputData</span>(ptr + Fixed32Size, m_file-&gt;<span class="built_in">getFileSize</span>() - Fixed32Size);</span><br><span class="line">            m_output-&gt;<span class="built_in">seek</span>(m_actualSize);</span><br><span class="line">            <span class="keyword">if</span> (needFullWriteback) &#123;</span><br><span class="line">                <span class="built_in">fullWriteback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// file not valid or empty, discard everything</span></span><br><span class="line">            <span class="built_in">SCOPED_LOCK</span>(m_exclusiveProcessLock);</span><br><span class="line"></span><br><span class="line">            m_output = <span class="keyword">new</span> <span class="built_in">CodedOutputData</span>(ptr + Fixed32Size, m_file-&gt;<span class="built_in">getFileSize</span>() - Fixed32Size);</span><br><span class="line">            <span class="keyword">if</span> (m_actualSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">writeActualSize</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, IncreaseSequence);</span><br><span class="line">                <span class="built_in">sync</span>(MMKV_SYNC);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">writeActualSize</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, KeepSequence);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">				...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_needLoadFromFile = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»Ÿæ¥è¯´å°±æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šå°†åŸºäº<code>protobuf</code>åè®®çš„æœ¬åœ°æ–‡ä»¶é‡Œé¢çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å°†å…¶æ”¾åœ¨ä¸€ä¸ª map å†…ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p>
<p>å›åˆ° <code>int32_t MMKV::getInt32()</code>é€šè¿‡ <code>getDataForKey(key)</code>è·å–åˆ°ä¸€ä¸ª<code>MMBuffer</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡ <strong>CodedInputData</strong>è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œè¯»å– <strong>Varint32</strong> çš„ <strong>valueSize</strong> å€¼ï¼Œéšåä¸æ–­å¾ªç¯é€šè¿‡ <strong>CodedInputData</strong>  è¯»å–åˆ°<strong>value</strong> å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">MMKV::getInt32</span><span class="params">(MMKVKey_t key, <span class="type">int32_t</span> defaultValue, <span class="type">bool</span> *hasValue)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">auto</span> data = <span class="built_in">getDataForKey</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="built_in">length</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="function">CodedInputData <span class="title">input</span><span class="params">(data.getPtr(), data.length())</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (hasValue != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">                *hasValue = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> input.<span class="built_in">readInt32</span>();</span><br><span class="line">        &#125; </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">  	...</span><br><span class="line">    <span class="keyword">return</span> defaultValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="mmkv-ä¸-SharedPreferences"><a href="#mmkv-ä¸-SharedPreferences" class="headerlink" title="mmkv ä¸ SharedPreferences"></a>mmkv ä¸ SharedPreferences</h2><p>ä»¥ä¸‹æ˜¯ <strong>MMKV</strong> ä¸ <strong>SharedPreferences</strong> çš„ä¼˜åŠ£åŠ¿å¯¹æ¯”æ€»ç»“ï¼Œç»“åˆæ€§èƒ½ã€å®‰å…¨æ€§ã€åŠŸèƒ½æ”¯æŒç­‰æ ¸å¿ƒç»´åº¦è¿›è¡Œåˆ†æï¼š</p>
<h3 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a><strong>æ€§èƒ½å¯¹æ¯”</strong></h3><table>
<thead>
<tr>
<th align="left"><strong>ç»´åº¦</strong></th>
<th align="left"><strong>SharedPreferences</strong></th>
<th align="left"><strong>MMKV</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>è¯»å†™é€Ÿåº¦</strong></td>
<td align="left">æ…¢ï¼ˆåŒæ­¥ I&#x2F;Oï¼Œå¤šæ¬¡æ•°æ®æ‹·è´ï¼‰</td>
<td align="left">å¿«ï¼ˆ<code>mmap</code> é›¶æ‹·è´ï¼Œå†…å­˜ç›´æ¥æ“ä½œï¼‰</td>
</tr>
<tr>
<td align="left"><strong>çº¿ç¨‹å®‰å…¨</strong></td>
<td align="left">éœ€è‡ªè¡ŒåŠ é”ï¼ˆ<code>apply()</code> å¼‚æ­¥å†™å…¥ä»æœ‰é£é™©ï¼‰</td>
<td align="left">å†…ç½®å¤šçº¿ç¨‹é”ï¼ˆæ–‡ä»¶é” + å†…å­˜é”ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å¤§æ•°æ®é‡æ”¯æŒ</strong></td>
<td align="left">æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼ˆå…¨é‡ XML è§£æ&#x2F;åºåˆ—åŒ–ï¼‰</td>
<td align="left">é«˜æ•ˆï¼ˆå¢é‡æ›´æ–°ï¼ŒProtobuf ç¼–ç ï¼‰</td>
</tr>
</tbody></table>
<h3 id="å®‰å…¨æ€§ä¸ç¨³å®šæ€§"><a href="#å®‰å…¨æ€§ä¸ç¨³å®šæ€§" class="headerlink" title="å®‰å…¨æ€§ä¸ç¨³å®šæ€§"></a><strong>å®‰å…¨æ€§ä¸ç¨³å®šæ€§</strong></h3><table>
<thead>
<tr>
<th align="left"><strong>ç»´åº¦</strong></th>
<th align="left"><strong>SharedPreferences</strong></th>
<th align="left"><strong>MMKV</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ•°æ®åŠ å¯†</strong></td>
<td align="left">æ— ï¼ˆæ˜æ–‡å­˜å‚¨ï¼‰</td>
<td align="left">æ”¯æŒ AES-128&#x2F;AES-256 åŠ å¯†</td>
</tr>
<tr>
<td align="left"><strong>å´©æºƒæ¢å¤</strong></td>
<td align="left">å¯èƒ½å› å¼‚å¸¸å¯¼è‡´ XML æŸå</td>
<td align="left">é€šè¿‡ CRC æ ¡éªŒ + å¤‡ä»½æ–‡ä»¶ä¿éšœå®Œæ•´æ€§</td>
</tr>
<tr>
<td align="left"><strong>ç³»ç»Ÿç‰ˆæœ¬é€‚é…</strong></td>
<td align="left">éƒ¨åˆ†ç‰ˆæœ¬æœ‰ ANR é—®é¢˜ï¼ˆå¦‚ <code>apply()</code>ï¼‰</td>
<td align="left">æ— ç³»ç»Ÿçº§å…¼å®¹æ€§é—®é¢˜</td>
</tr>
</tbody></table>
<h3 id="åŠŸèƒ½æ”¯æŒ"><a href="#åŠŸèƒ½æ”¯æŒ" class="headerlink" title="åŠŸèƒ½æ”¯æŒ"></a><strong>åŠŸèƒ½æ”¯æŒ</strong></h3><table>
<thead>
<tr>
<th align="left"><strong>ç»´åº¦</strong></th>
<th align="left"><strong>SharedPreferences</strong></th>
<th align="left"><strong>MMKV</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å¤šè¿›ç¨‹</strong></td>
<td align="left">ä¸æ”¯æŒï¼ˆè·¨è¿›ç¨‹æ•°æ®ä¸åŒæ­¥ï¼‰</td>
<td align="left">æ”¯æŒï¼ˆé€šè¿‡æ–‡ä»¶é” + <code>mmap</code> å…±äº«å†…å­˜ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®ç±»å‹</strong></td>
<td align="left">ä»…æ”¯æŒåŸºæœ¬ç±»å‹ï¼ˆint&#x2F;String ç­‰ï¼‰</td>
<td align="left">æ”¯æŒåŸºæœ¬ç±»å‹ã€äºŒè¿›åˆ¶æ•°æ®ï¼ˆMMBufferï¼‰</td>
</tr>
<tr>
<td align="left"><strong>åŠ å¯†å­˜å‚¨</strong></td>
<td align="left">æ˜æ–‡å­˜å‚¨ï¼ˆXMLï¼‰</td>
<td align="left">æ”¯æŒ AES åŠ å¯†ï¼ˆå¯é€‰ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å¢é‡æ›´æ–°</strong></td>
<td align="left">å…¨é‡å†™å…¥ï¼ˆå³ä½¿åªæ”¹ä¸€ä¸ªé”®å€¼ï¼‰</td>
<td align="left">ä»…è¿½åŠ æ–°æ•°æ®ï¼Œå®šæœŸæ•´ç†</td>
</tr>
</tbody></table>
<p>ä»ä¸Šé¢çš„å¯¹æ¯”çœ‹çœ‹ï¼Œmmkv åœ¨å¾ˆå¤šå±‚é¢éƒ½æ˜¯é¢†å…ˆ SharedPreferences çš„ï¼Œé‚£ä¹ˆ mmkv æ˜¯å¦æœ‰ç¼ºé™·å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ã€‚</p>
<blockquote>
<p>ä»»ä½•çš„æ“ä½œç³»ç»Ÿã€ä»»ä½•çš„è½¯ä»¶ï¼Œåœ¨å¾€ç£ç›˜å†™æ•°æ®çš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿäº†æ„å¤–â€”â€”ä¾‹å¦‚ç¨‹åºå´©æºƒï¼Œæˆ–è€…æ–­ç”µå…³æœºâ€”â€”ç£ç›˜é‡Œçš„æ–‡ä»¶å°±ä¼šä»¥è¿™ç§å†™äº†ä¸€åŠçš„ã€ä¸å®Œæ•´çš„å½¢å¼è¢«ä¿ç•™ã€‚å†™äº†ä¸€åŠçš„æ•°æ®æ€ä¹ˆç”¨å•Šï¼Ÿæ²¡æ³•ç”¨ï¼Œè¿™å°±æ˜¯æ–‡ä»¶çš„æŸåã€‚è¿™ç§é—®é¢˜æ˜¯ä¸å¯èƒ½é¿å…çš„ï¼ŒMMKV è™½ç„¶ç”±äºåº•å±‚æœºåˆ¶çš„åŸå› ï¼Œåœ¨ç¨‹åºå´©æºƒçš„æ—¶å€™ä¸ä¼šå½±å“æ•°æ®å¾€ç£ç›˜çš„å†™å…¥ï¼Œä½†æ–­ç”µå…³æœºä¹‹ç±»çš„æ“ä½œç³»ç»Ÿçº§åˆ«çš„å´©æºƒï¼ŒMMKV å°±æ²¡åŠæ³•äº†ï¼Œæ–‡ä»¶ç…§æ ·ä¼šæŸåã€‚å¯¹äºè¿™ç§æ–‡ä»¶æŸåï¼ŒSharedPreferences å’Œ DataStore çš„åº”å¯¹æ–¹å¼æ˜¯åœ¨æ¯æ¬¡å†™å…¥æ–°æ•°æ®ä¹‹å‰éƒ½å¯¹ç°æœ‰æ–‡ä»¶åšä¸€æ¬¡è‡ªåŠ¨å¤‡ä»½ï¼Œè¿™æ ·åœ¨å‘ç”Ÿäº†æ„å¤–å‡ºç°äº†æ–‡ä»¶æŸåä¹‹åï¼Œå®ƒä»¬å°±ä¼šæŠŠå¤‡ä»½çš„æ•°æ®æ¢å¤è¿‡æ¥ï¼›è€Œ MMKVï¼Œæ²¡æœ‰è¿™ç§è‡ªåŠ¨çš„å¤‡ä»½å’Œæ¢å¤ï¼Œé‚£ä¹ˆå½“æ–‡ä»¶å‘ç”Ÿäº†æŸåï¼Œæ•°æ®å°±ä¸¢äº†ï¼Œä¹‹å‰ä¿å­˜çš„å„ç§ä¿¡æ¯åªèƒ½è¢«é‡ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMMKV æ˜¯å”¯ä¸€ä¼šä¸¢æ•°æ®çš„æ–¹æ¡ˆã€‚</p>
</blockquote>
<p>åœ¨ mmkv é‡Œé¢æœ‰ <a href="https://info.support.huawei.com/info-finder/encyclopedia/zh/CRC.html">CRC</a> æ ¡éªŒï¼Œå¦‚æœä¸é€šè¿‡çš„è¯ï¼Œå°†ä¼šåºŸå¼ƒæ‰ä¹‹å‰æ‰€æœ‰çš„æ•°æ®ã€‚åœ¨ mmkv é‡Œé¢ä¹Ÿæœ‰äººåé¦ˆï¼š<a href="https://github.com/Tencent/MMKV/issues/729">https://github.com/Tencent/MMKV/issues/729</a> åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å› ä¸ºä¸€äº›ç‰¹æ®Šæƒ…å†µå†™å…¥å¤±è´¥ï¼Œä¼šå¯¼è‡´æœ¬åœ°çš„æ–‡ä»¶æŸåä¸”ä¸å¯recoveryã€‚</p>
<p>é‚£æœ‰ä»€ä¹ˆåŠæ³•é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰å¤§ä½¬å¼€æºå¦ä¸€ä¸ª KV æ¡†æ¶ <a href="https://github.com/BillyWei01/FastKV">FastKV</a>å¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œäº†å¤„ç†ï¼Œé‡‡ç”¨é€šè¿‡double-writeç­‰æ–¹æ³•ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ï¼ŒåŸç†æ˜¯æ•°æ®ä¾æ¬¡å†™å…¥A&#x2F;Bä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå†™å…¥Aè¿‡ç¨‹ä¸­å´©æºƒï¼ŒBä»æ˜¯å®Œæ•´çš„ï¼Œå¦‚æœAå®Œæ•´å†™å…¥äº†ï¼Œåˆ™Bå†™å…¥æ—¶å´©æºƒä¹Ÿä¸è¦ç´§ã€‚è¿™ç§å®ç°æ–¹å¼ç†è®ºä¸Šæ˜¯ä¸é”™çš„ï¼Œä¸å¤ªæ¸…æ¥š mmkv ä¸ºä»€ä¹ˆæ²¡æœ‰é‡‡å–è¿™æ ·çš„é€»è¾‘ã€‚ä¸è¿‡è¿™ä¸ªåº“å¹¶æ²¡æœ‰ç»è¿‡å¤§é‡ä¸šåŠ¡è¿›è¡ŒéªŒè¯ï¼Œåªèƒ½ä½œä¸ºä¸€ä¸ªå­¦ä¹ çš„æ–¹æ¡ˆå…ˆçœ‹çœ‹ã€‚</p>
<p>å¦å¤–è°·æ­Œå·²ç»å¼€å‘äº†æ–°çš„KVå­˜å‚¨æ¡†æ¶<a href="https://cloud.google.com/datastore/docs/concepts/overview?hl=zh-cn">DataStore</a>ï¼Œ<code>SharedPreferences</code>ä¹Ÿå°†æ¸æ¸åœ°é€€å‡ºå†å²çš„èˆå°äº†ã€‚ä¸è¿‡ DataStore çš„æ€§èƒ½ç›®å‰ä»ç„¶æ²¡æœ‰ mmkv çš„å¥½ã€‚å…³äºè¿™ä¸‰è€…çš„æ¯”è¾ƒå¯ä»¥æŸ¥çœ‹ï¼š <a href="https://juejin.cn/post/7112268981163016229">ã€ŠAndroid çš„é”®å€¼å¯¹å­˜å‚¨æœ‰æ²¡æœ‰æœ€ä¼˜è§£ï¼Ÿã€‹</a></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« æ·±å…¥å‰–æäº† <strong>MMKV</strong>ï¼ˆè…¾è®¯å¼€æºçš„é«˜æ€§èƒ½é”®å€¼å­˜å‚¨ç»„ä»¶ï¼‰çš„æ ¸å¿ƒè®¾è®¡ä¸å®ç°åŸç†ï¼Œé‡ç‚¹å¯¹æ¯”äº†ä¼ ç»Ÿ I&#x2F;O ä¸ <code>mmap</code> å†…å­˜æ˜ å°„çš„å·®å¼‚ï¼Œå¹¶è¯¦ç»†åˆ†æäº† MMKV çš„è¯»å†™æµç¨‹ä»¥åŠå’Œ SharedPreferences çš„å„æ–¹é¢å¯¹æ¯”ã€‚</p>
<p><strong>å‚è€ƒ</strong></p>
<p><a href="https://juejin.cn/post/7112268981163016229">ã€ŠAndroid çš„é”®å€¼å¯¹å­˜å‚¨æœ‰æ²¡æœ‰æœ€ä¼˜è§£ï¼Ÿã€‹</a></p>
<p><a href="https://yangjie2.github.io/2021/11/14/mmap%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/">ã€ŠmmapåŸç†ä¸åº”ç”¨ã€‹</a></p>
<p><a href="https://blog.csdn.net/zhanglh046/article/details/115603788">ã€Šæ–‡ä»¶å†…å­˜æ˜ å°„å’Œä¼ ç»ŸI&#x2F;Oæœºåˆ¶ã€‹</a></p>
<p><a href="https://blog.csdn.net/luo_boke/article/details/109311432">Android å†…å­˜æ˜ å°„mmapæµ…è°ˆ</a></p>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css?v=1.0.0"><script type="text/javascript" src="/js/donate.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><a class="pos-f tr3" id="github" href="https://github.com/Kaiyuan/donate-page" target="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="AliPay" qr="https://cdn.julis.wang/blog/img/ali_pay.jpeg"></li><li id="WeChat" qr="https://cdn.julis.wang/blog/img/wechat_pay.png"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mmap/" rel="tag">mmap</a></li></ul></div><div class="post-nav"><a class="pre" href="/2025/05/16/%E9%B8%BF%E8%92%99-%E5%86%99%E4%BA%86%E4%B8%AA%E5%9F%BA%E4%BA%8EHexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E9%B8%BF%E8%92%99App/">[é¸¿è’™]å†™äº†ä¸ªåŸºäºHexoåšå®¢çš„é¸¿è’™App</a><a class="next" href="/2025/03/17/Learn-from-RetroFit/">RetroFit2 æºç å­¦ä¹ ç›¸å…³</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.png"/></a><p>For a better life.</p><a class="info-icon" href="mailto:admin@domain.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/vompom" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://www.douban.com/people/vompom/" title="è±†ç“£" target="_blank" style="margin-inline:5px"> <i class="fa fa-vimeo-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">æ€è€ƒæ€»ç»“</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">æŠ€æœ¯æ–‡ç« </a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">ç”Ÿæ´»æ„Ÿæƒ³</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95%E7%A0%94%E7%A9%B6/">ç®—æ³•ç ”ç©¶</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/movie/">è¯»ä¹¦ç”µå½±</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/travel/" style="font-size: 15px;">æ—…è¡Œ</a> <a href="/tags/zhihu/" style="font-size: 15px;">çŸ¥ä¹</a> <a href="/tags/plugins/" style="font-size: 15px;">æ’ä»¶åŒ–</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 15px;">é€†å‘</a> <a href="/tags/FFmpeg/" style="font-size: 15px;">FFmpeg</a> <a href="/tags/MediaCodec/" style="font-size: 15px;">MediaCodec</a> <a href="/tags/Android/" style="font-size: 15px;">å®‰å“</a> <a href="/tags/KMP/" style="font-size: 15px;">KMP</a> <a href="/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tags/Https/" style="font-size: 15px;">Https</a> <a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/JNI/" style="font-size: 15px;">JNI</a> <a href="/tags/java/" style="font-size: 15px;">Java</a> <a href="/tags/mmap/" style="font-size: 15px;">mmap</a> <a href="/tags/koin/" style="font-size: 15px;">koin</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">ç½‘ç»œ</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/life/" style="font-size: 15px;">ç”Ÿæ´»</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 15px;">è¯»ä¹¦</a> <a href="/tags/thinking/" style="font-size: 15px;">çœ</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 15px;">æ•°å­¦</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">æ’ä»¶</a> <a href="/tags/UTF-8/" style="font-size: 15px;">UTF-8</a> <a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 15px;">å¤§å­¦</a> <a href="/tags/algorithm/" style="font-size: 15px;">ç®—æ³•</a> <a href="/tags/design/" style="font-size: 15px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">å·¥å…·</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/technology/" style="font-size: 15px;">æŠ€æœ¯æ–‡ç« </a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">å‰ç«¯</a> <a href="/tags/%E8%AF%97%E6%AD%8C/" style="font-size: 15px;">è¯—æ­Œ</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">é¢è¯•</a> <a href="/tags/middle/" style="font-size: 15px;">é«˜ä¸­</a> <a href="/tags/%E9%B8%BF%E8%92%99/" style="font-size: 15px;">é¸¿è’™</a> <a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a> <a href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/" style="font-size: 15px;">éŸ³è§†é¢‘</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/08/25/Koin-%E6%BA%90%E7%A0%81%E7%90%86%E8%A7%A3%E7%9B%B8%E5%85%B3/">æ‰‹å†™ä¸€ä¸ªç²¾ç®€ç‰ˆKoinï¼šæ·±å…¥ç†è§£ä¾èµ–æ³¨å…¥æ ¸å¿ƒåŸç†</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/07/28/Compose-Multiplatform-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%8D%9A%E5%AE%A2%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/">[Compose Multiplatform]è·¨å¹³å°åšå®¢åº”ç”¨å®è·µ</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/05/16/%E9%B8%BF%E8%92%99-%E5%86%99%E4%BA%86%E4%B8%AA%E5%9F%BA%E4%BA%8EHexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E9%B8%BF%E8%92%99App/">[é¸¿è’™]å†™äº†ä¸ªåŸºäºHexoåšå®¢çš„é¸¿è’™App</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/30/KV-%E5%AD%98%E5%82%A8%E4%B9%8Bmmkv/">KV-å­˜å‚¨ä¹‹mmkv</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/17/Learn-from-RetroFit/">RetroFit2 æºç å­¦ä¹ ç›¸å…³</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/24/Android%E5%B1%8F%E5%B9%95%E5%88%B7%E6%96%B0%E6%9C%BA%E5%88%B6/">Androidå±å¹•åˆ·æ–°æœºåˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/11/10/%E5%85%B3%E4%BA%8E-pthread-key-t-%E5%AF%BC%E8%87%B4%E7%9A%84-Android-Crash-%E7%9A%84%E6%8E%A2%E7%B4%A2/">å…³äº pthread_key_t å¯¼è‡´çš„ Android Crash çš„æ¢ç´¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/09/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E7%9A%84%E5%B8%B8%E9%9D%92%E6%8A%80%E8%83%BD/">[è¯‘]è½¯ä»¶å¼€å‘äººå‘˜çš„å¸¸é’æŠ€èƒ½</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/04/11/%E5%85%B3%E4%BA%8EWindows%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%E4%B9%B1%E7%A0%81/">UTF-8å­—ç¬¦ç¼–ç ç›¸å…³</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/03/07/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89FFmpeg-Filter/">å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ FFmpeg Filter</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://github.com/VomPom" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.douban.com/people/vompom/" title="è±†ç“£" target="_blank">è±†ç“£</a><ul></ul><a href="mailto:1607637473@qq.com" title="é‚®ç®±" target="_blank">é‚®ç®±</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2025 <a href="/." rel="nofollow">è½å¶æŒ½æ­Œ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.<p></a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>